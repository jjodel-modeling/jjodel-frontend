{"ast":null,"code":"import _get from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _createClass from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _toConsumableArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";var _dec,_class,_class2,_dec2,_class3,_class4,_dec3,_class5,_class6,_dec4,_class7,_class8,_dec5,_class9,_class10,_dec6,_class11,_class12,_dec7,_class13,_class14,_dec8,_class15,_class16,_dec9,_class17,_class18,_dec10,_class19,_class20,_dec11,_class21;import{Constructors,DPointerTargetable,DUser,Log,Pointers,RuntimeAccessible,RuntimeAccessibleClass,store,windoww}from\"../../joiner\";// transactional-like start of storage modification\n// todo: nested transaction che conti quanti begin hai effettuato e crei una matrice di pendingActions una per ogni livello nested?\n/*\r\n// let nestedlevel: number = 0;\r\nclass NestedLevel{\r\n    level: number;\r\n    actions: Action[] = [];\r\n    up:NestedLevel[] = [];\r\n    down?:NestedLevel;\r\n\r\n    constructor(prevLevel?: NestedLevel, actions: Action[] = []) {\r\n        // this.prev = prev;\r\n        this.down = prevLevel;\r\n        this.actions = actions;\r\n        this.level = prevLevel ? prevLevel.level + 1 : 0;\r\n    }\r\n\r\n    add1(a:Action){ this.actions.push(a); }\r\n    add(a:Action[]){ this.actions.push(...a); }\r\n    push(actions:Action[]=[]){\r\n        this.up.push(new NestedLevel(this, actions));\r\n    }\r\n}\r\n// @Singleton\r\nclass NestedTransactionManager{\r\n    // private levels: NestedLevel[] = [];\r\n    public currentLevel?: NestedLevel;\r\n    // simple array is not good i can have spikes as russian mountains going up and down in deepness it's kinda a matrix or a pile of dishes like below'\r\n\r\n\r\n    /*\r\n    todo: to debug missing END paired with a begin, seve stack trace of begins and ends\r\n    * every level must have his own array?\r\n    * Begin0, Begin1, Begin2, End2, End1, Begin1.1 Begin 1.2....\r\n    it's a tree!\r\n    *\r\n    *\r\n    * ______begin lv2                              _______Begin1.2\r\n    * _________________________begin lv1           ___________________Begin1.1\r\n    * ____________________________________________________________________________________________________ a begin lv0\r\n    * * /\r\n    constructor() {}\r\n    begin(actions: Action[]=[]): void { this.pushLevel(actions); }\r\n    pushLevel(actions: Action[]=[]): void {\r\n        if (!this.currentLevel) { this.currentLevel = new NestedLevel(undefined, actions); return; }\r\n        this.currentLevel.push(actions); }\r\n    end(){\r\n        if (!this.currentLevel) return this.finalEnd();\r\n        this.currentLevel = this.currentLevel?.down; }\r\n    finalEnd(){\r\n\r\n    }\r\n    // current(): NestedLevel { return this.currentLevel; }\r\n    addActions(a:Action[]): void { this.currentLevel!.add(a); }\r\n    addAction(a:Action): void { this.currentLevel!.add1(a); }\r\n}\r\nlet transactionmanager = new NestedTransactionManager();\r\nfunction BEGIN2(){\r\n    transactionmanager.pushLevel();\r\n}\r\nfunction ABORT2(){\r\n    transactionmanager.end();\r\n}\r\nfunction END2(){\r\n\r\n}*/var TransactionStatus=function TransactionStatus(){_classCallCheck(this,TransactionStatus);this.pendingActions=[];this.hasBegun=false;this.hasAborted=false;this.transactionDepthLevel=0;};var t=new TransactionStatus();windoww.transactionStatus=t;export function BEGIN(){t.hasBegun=true;// redundant but actions are reading this, minimize changes\nt.transactionDepthLevel++;}export function ABORT(){t.hasAborted=true;// at any depth level since i have only a flat TRANSACTION array\nEND();}export function END(){var actionstoPrepend=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];t.transactionDepthLevel--;if(actionstoPrepend.length)t.pendingActions=[].concat(_toConsumableArray(actionstoPrepend),_toConsumableArray(t.pendingActions));if(t.transactionDepthLevel<0){console.error(\"mismatching END()\");t.transactionDepthLevel=0;}if(t.transactionDepthLevel===0)return FINAL_END();return false;}export function FINAL_END(){console.warn(\"FINAL_END\");t.hasBegun=false;// pendingActions.sort( (a, b) => a.timestamp - b.timestamp)\nif(t.hasAborted){t.pendingActions=[];t.hasAborted=false;return false;}var ca=new CompositeAction(t.pendingActions,false);t.pendingActions=[];return ca.fire();}// make class isinstorage e mettici il path studia annotazioni per annotare gli oggett in modo che vengano rwappati prima di farli ritornare se sono annotati\n// minor todo: type as (...args: infer P) => any) ?\n// NB: cannot be async, it changes execution order and break many codes where return value is determined in a transaction.\n// also because BEGIN() becomes stuck and actions cannot fire until the server replies or times out.\nexport function TRANSACTION(func){//export function TRANSACTION<F extends NoAsyncFn)>(func: F, ...params: Parameters<F>): boolean | DState {\nBEGIN();// minor todo: potrei fare l'override di Error() per fare in modo che gli errori vengano presi anche se non uso TRANSACTION o try-catch ?\ntry{for(var _len=arguments.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){params[_key-1]=arguments[_key];}func.apply(void 0,params);}catch(e){Log.ee('Transaction failed:',e);ABORT();return false;}return END();}window.TRANSACTION=TRANSACTION;window.BEGIN=BEGIN;window.ABORT=ABORT;window.END=END;window.FINAL_END=FINAL_END;window.maxActionFiring=0;// todo: ma non so come, fare in modo che [], +=, -=, siano disponibili solo se la chiave è il nome di un attributo di tipo array\nexport var Action=(_dec=RuntimeAccessible('Action'),_dec(_class=(_class2=/*#__PURE__*/function(_RuntimeAccessibleCla){_inherits(Action,_RuntimeAccessibleCla);var _super=_createSuper(Action);// targetID: string | undefined;\n// target: IClass = null as any;\n// field: string = ''; // es: ID_58\n// value: any; // es: lowerbound, name, namespace, values (for attrib-ref)...\n// private src?: string[];\n//?\nfunction Action(field,value,subType){var _Error$stack;var _this;_classCallCheck(this,Action);_this=_super.call(this);_this.field=void 0;_this.value=void 0;_this.id=void 0;_this.timestamp=void 0;_this.sender=void 0;_this.hasFired=0;_this.consoleTargetSelector='';_this.type=void 0;_this.subType=void 0;_this.stack=void 0;_this.id='Action_'+Date.now()+\"_\"+Action.maxCounter++;// NB: the prefix must be the same for all actions because it must not affect order\n_this.timestamp=Date.now();_this.sender=DUser.current;_this.field=field;_this.value=value;_this.type=_this.constructor.type;_this.stack=(_Error$stack=new Error().stack)===null||_Error$stack===void 0?void 0:_Error$stack.split('\\n').splice(4);_this.subType=subType;_this.className=_this.constructor.cname||_this.constructor.name;return _this;}_createClass(Action,[{key:\"fire\",value:function fire(){var forceRelaunch=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.hasFired&&!forceRelaunch)return false;if(this.value&&this.value.__isProxy){Log.ee(\"Attempted to set a proxy object inside the store.\",{action:this,value:this.value});return false;}this.hasFired++;if(t.hasBegun){t.pendingActions.push(this);}else{var _actions;// if ((window as any).maxActionFiring++ >= 400) return false;\nvar storee=store||windoww.store;console.log('firing action:',{field:this.field,val:this.value,// stack:this.src,\nthiss:this,n:((_actions=this.actions)===null||_actions===void 0?void 0:_actions.length)||1});storee.dispatch(_objectSpread({},this));}return true;}}],[{key:\"parse1\",value:function parse1(action){var ret=action;ret.path=action.field;// normalize the path\nret.pathArray=ret.path.split('.');ret.executionCount=0;if(!action.subType)return ret;if(!Action.possibleInconsistencies[action.subType])Action.possibleInconsistencies[action.subType]=[action.value];else Action.possibleInconsistencies[action.subType].push(action.value);return ret;}},{key:\"parse\",value:function parse(actions){if(actions.className===CompositeAction.cname)throw new Error(\"Composite action cannot be parsed directly, parse composite.actions instead\");if(!Array.isArray(actions))return Action.parse1(actions);return actions.map(Action.parse1);}},{key:\"fromJson\",value:function fromJson(json){var action=new Action('dummy','dummy');for(var key in action){delete action[key];}// resetting the action\nfor(var _key2 in json){action[_key2]=json[_key2];}return action;}}]);return Action;}(RuntimeAccessibleClass),_class2.cname=\"Action\",_class2.maxCounter=1,_class2.subclasses=[],_class2._extends=[],_class2.type='ACTION',_class2.SubType=void 0,_class2.possibleInconsistencies={},_class2))||_class);export var LoadAction=(_dec2=RuntimeAccessible('LoadAction'),_dec2(_class3=(_class4=/*#__PURE__*/function(_Action){_inherits(LoadAction,_Action);var _super2=_createSuper(LoadAction);function LoadAction(state){var _this2;var fire=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,LoadAction);_this2=_super2.call(this,'',state,'');_this2.className=_this2.constructor.cname||_this2.constructor.name;if(fire)_this2.fire();return _this2;}_createClass(LoadAction,null,[{key:\"new\",value:function _new(state){return state&&new LoadAction(state).fire();}},{key:\"create\",value:function create(state){return state&&new LoadAction(state);}}]);return LoadAction;}(Action),_class4.cname=\"LoadAction\",_class4.type='LOAD',_class4))||_class3);export var SetRootFieldAction=(_dec3=RuntimeAccessible('SetRootFieldAction'),_dec3(_class5=(_class6=/*#__PURE__*/function(_Action2){_inherits(SetRootFieldAction,_Action2);var _super3=_createSuper(SetRootFieldAction);function SetRootFieldAction(fullpath){var _this3;var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;var fire=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var isPointer=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,SetRootFieldAction);_this3=_super3.call(this,fullpath,value,undefined);_this3.isPointer=void 0;_this3.className=_this3.constructor.cname||_this3.constructor.name;_this3.isPointer=isPointer;if(fire)_this3.fire();return _this3;}_createClass(SetRootFieldAction,[{key:\"fire\",value:function fire(){var forceRelaunch=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var doChecks=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;/* no need, the reducer should return old state in this case. verify it!\r\n        if (doChecks) {\r\n            // if action would not change the value, i don't fire it at all\r\n            let s: GObject<DState> = store.getState();\r\n            let field = (this.field||'');\r\n            let accessOperator: string = field.substring(field.length-2);\r\n            let fieldpath: string[] = field.split(\".\");\r\n            switch(accessOperator){\r\n                default:\r\n                case \"-=\":\r\n                case \"+=\":\r\n            }\r\n            // path can end with -=, +=, [] etc, but it's fine if i check it as if it was part of the name like object[\"fieldname+=\"]\r\n            // because in all those cases\r\n            if (s[this.field] === this.value) return false;\r\n        }*/return _get(_getPrototypeOf(SetRootFieldAction.prototype),\"fire\",this).call(this,forceRelaunch);}}],[{key:\"create\",value:function create(fullpath,val){var accessModifier=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;var isPointer=arguments.length>3?arguments[3]:undefined;if(accessModifier)fullpath+=accessModifier;return new SetRootFieldAction(fullpath,val,false,isPointer);}},{key:\"new\",value:function _new(){return SetRootFieldAction.create.apply(SetRootFieldAction,arguments).fire();}},{key:\"create_old\",value:function create_old(tocheck,fullpath,val){var accessModifier=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var isPointer=arguments.length>4?arguments[4]:undefined;return new SetRootFieldAction(fullpath+(accessModifier||''),val,false,isPointer);}}]);return SetRootFieldAction;}(Action),_class6.cname=\"SetRootFieldAction\",_class6.subclasses=[],_class6._extends=[],_class6.type='SET_ROOT_FIELD',_class6))||_class5);export var SetFieldAction=(_dec4=RuntimeAccessible('SetFieldAction'),_dec4(_class7=(_class8=/*#__PURE__*/function(_SetRootFieldAction){_inherits(SetFieldAction,_SetRootFieldAction);var _super4=_createSuper(SetFieldAction);// field can end with \"+=\", \"[]\", or \"-1\" if it's array\nfunction SetFieldAction(me,field,val){var _this4;var fire=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var isPointer=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;_classCallCheck(this,SetFieldAction);Log.exDev(!me,'BaseObject missing in SetFieldAction',{me:me,field:field,val:val});_this4=_super4.call(this,'idlookup.'+(me.id||me)+(field?'.'+field:''),val,false,isPointer);_this4.me=void 0;_this4.me_field=void 0;_this4.me=me;_this4.me_field=field;_this4.className=_this4.constructor.cname||_this4.constructor.name;if(fire)_this4.fire();return _this4;}_createClass(SetFieldAction,[{key:\"fire\",value:function fire(){var _this$me;var forceRelaunch=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;// if action would not change the value, i don't fire it at all\n// by id because if item was updated, this.me as DElement might be an old version, different from the one in store.\nvar d=DPointerTargetable.from(((_this$me=this.me)===null||_this$me===void 0?void 0:_this$me.id)||this.me);// console.warn(\"me fire\", {thiss:this, d, typeofd:typeof d, field:this.me_field, dfield:d[this.me_field], val:this.value});\nif(d&&typeof d===\"object\"&&d[this.me_field]===this.value)return false;return _get(_getPrototypeOf(SetFieldAction.prototype),\"fire\",this).call(this,forceRelaunch,false);}}],[{key:\"create\",value:function create(me,field,val){var accessModifier=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var isPointer=arguments.length>4?arguments[4]:undefined;if(accessModifier)field+=accessModifier;return new SetFieldAction(me,field,val,false,isPointer);}},{key:\"new\",value:function _new(me,field,val){var accessModifier=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var isPointer=arguments.length>4?arguments[4]:undefined;if(accessModifier)field+=accessModifier;return new SetFieldAction(me,field,val,false,isPointer).fire();}}]);return SetFieldAction;}(SetRootFieldAction),_class8.type='SET_ME_FIELD',_class8))||_class7);/*\r\ncould put in documentation\r\nlet dclass: DClass = null as any;\r\nSetFieldAction.new(dclass, 'namek', '') // non è un attributo di \"DCLass\"\r\nSetFieldAction.new(dclass, 'parent', '') // val (stringa) non è assegnabile a parent (array di puntatori)\r\nSetFieldAction.new(dclass, 'name.5k', '') // non è un indice array valido\r\nSetFieldAction.new(dclass, 'name[4k]', '') // non è un indice array valido\r\nSetFieldAction.new(dclass, 'name[4]', '') // ok, anche se non dovrebbe accettare la dicitura array per name che è un primitivo (check non implementato, troppo difficile)\r\nSetFieldAction.new(dclass, 'name.5', '') // ok, equivale a dicitura array\r\n*/export var RedoAction=(_dec5=RuntimeAccessible('RedoAction'),_dec5(_class9=(_class10=/*#__PURE__*/function(_Action3){_inherits(RedoAction,_Action3);var _super5=_createSuper(RedoAction);function RedoAction(){var _this5;var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,RedoAction);_this5=_super5.call(this,'',amount);_this5.className=_this5.constructor.cname||_this5.constructor.name;return _this5;}_createClass(RedoAction,null,[{key:\"new\",value:function _new(){var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var notfire=arguments.length>1?arguments[1]:undefined;var act=new RedoAction(amount);if(!notfire)return act.fire();return act;}}]);return RedoAction;}(Action),_class10.cname=\"RedoAction\",_class10.type='RedoAction',_class10))||_class9);export var UndoAction=(_dec6=RuntimeAccessible('UndoAction'),_dec6(_class11=(_class12=/*#__PURE__*/function(_Action4){_inherits(UndoAction,_Action4);var _super6=_createSuper(UndoAction);function UndoAction(){var _this6;var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,UndoAction);_this6=_super6.call(this,'',amount);_this6.className=_this6.constructor.cname||_this6.constructor.name;return _this6;}_createClass(UndoAction,null,[{key:\"new\",value:function _new(){var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var notfire=arguments.length>1?arguments[1]:undefined;var act=new UndoAction(amount);if(!notfire)return act.fire();return act;}}]);return UndoAction;}(Action),_class12.cname=\"UndoAction\",_class12.type='UndoAction',_class12))||_class11);// todo: delete or find original idea back\nexport var CombineHistoryAction=(_dec7=RuntimeAccessible('CombineHistoryAction'),_dec7(_class13=(_class14=/*#__PURE__*/function(_Action5){_inherits(CombineHistoryAction,_Action5);var _super7=_createSuper(CombineHistoryAction);function CombineHistoryAction(){var _this7;_classCallCheck(this,CombineHistoryAction);_this7=_super7.call(this,'','');_this7.className=_this7.constructor.cname||_this7.constructor.name;return _this7;}_createClass(CombineHistoryAction,null,[{key:\"new\",value:function _new(notfire){var act=new CombineHistoryAction();if(!notfire)return act.fire();return act;}}]);return CombineHistoryAction;}(Action),_class14.cname=\"CombineHistoryAction\",_class14.type='CombineHistoryAcCombineHistoryActiontion',_class14))||_class13);export var CreateElementAction=(_dec8=RuntimeAccessible('CreateElementAction'),_dec8(_class15=(_class16=/*#__PURE__*/function(_Action6){_inherits(CreateElementAction,_Action6);var _super8=_createSuper(CreateElementAction);function CreateElementAction(me){var _this8;var fire=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,CreateElementAction);_this8=_super8.call(this,'idlookup.'+me.id,me);_this8.value=void 0;_this8.className=_this8.constructor.cname||_this8.constructor.name;_this8.value=me;if(fire)_this8.fire();return _this8;}_createClass(CreateElementAction,[{key:\"fire\",value:function fire(){var _this9=this;var forceRelaunch=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var ret=false;TRANSACTION(function(){ret=_get(_getPrototypeOf(CreateElementAction.prototype),\"fire\",_this9).call(_this9,forceRelaunch);if(_this9.value._derivedSubElements||_this9.value._persistCallbacks){Constructors.persist(_this9.value,true);}});return ret;}}],[{key:\"newBatch\",value:function newBatch(me,notfire){var ret=[];TRANSACTION(function(){return ret=me.map(function(e){return CreateElementAction.new(e,notfire);});});return ret;}},{key:\"create\",value:function create(me){if(me.__raw)me=me.__raw;return new CreateElementAction(me,true);}},{key:\"new\",value:function _new(me,notfire){var act=CreateElementAction.create(me);if(!notfire)return act.fire();return act;}}]);return CreateElementAction;}(Action),_class16.cname=\"CreateElementAction\",_class16.type='CREATE_ELEMENT',_class16))||_class15);export var DeleteElementAction=(_dec9=RuntimeAccessible('DeleteElementAction'),_dec9(_class17=(_class18=/*#__PURE__*/function(_SetFieldAction){_inherits(DeleteElementAction,_SetFieldAction);var _super9=_createSuper(DeleteElementAction);function DeleteElementAction(me){var _this10;_classCallCheck(this,DeleteElementAction);_this10=_super9.call(this,Pointers.from(me),'',undefined);_this10.className=_this10.constructor.cname||_this10.constructor.name;return _this10;}_createClass(DeleteElementAction,null,[{key:\"create\",value:function create(me){return new DeleteElementAction(me);}},{key:\"new\",value:function _new(me){return new DeleteElementAction(me).fire();}}]);return DeleteElementAction;}(SetFieldAction),_class18.type='DELETE_ELEMENT',_class18))||_class17);/*\r\n\r\n@RuntimeAccessible\r\nexport class IDLinkAction extends Action{\r\n    constructor() {\r\n        super(IDLinkAction.name,\r\n    }\r\n    nope, uso un proxy\r\n}*/export var CompositeAction=(_dec10=RuntimeAccessible('CompositeAction'),_dec10(_class19=(_class20=/*#__PURE__*/function(_Action7){_inherits(CompositeAction,_Action7);var _super10=_createSuper(CompositeAction);function CompositeAction(actions){var _this11;var launch=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_classCallCheck(this,CompositeAction);_this11=_super10.call(this,'','');_this11.actions=[];_this11.actions=actions;_this11.className=_this11.constructor.cname||_this11.constructor.name;if(launch)_this11.fire();return _this11;}_createClass(CompositeAction,[{key:\"fire\",value:function fire(forceRelanch){if(!this.actions.length)return false;return _get(_getPrototypeOf(CompositeAction.prototype),\"fire\",this).call(this,forceRelanch);}}],[{key:\"new\",value:function _new(actions){var launch=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return new CompositeAction(actions,launch);}}]);return CompositeAction;}(Action),_class20.type='COMPOSITE_ACTION',_class20))||_class19);export var ParsedAction=(_dec11=RuntimeAccessible('ParsedAction'),_dec11(_class21=/*#__PURE__*/function(_SetRootFieldAction2){_inherits(ParsedAction,_SetRootFieldAction2);var _super11=_createSuper(ParsedAction);function ParsedAction(){var _this12;_classCallCheck(this,ParsedAction);for(var _len2=arguments.length,args=new Array(_len2),_key3=0;_key3<_len2;_key3++){args[_key3]=arguments[_key3];}_this12=_super11.call.apply(_super11,[this].concat(args));_this12.path=void 0;_this12.pathArray=void 0;_this12.executionCount=void 0;return _this12;}// NB: actually this is never created but \"converted\" from other actions by adding fields\n// path to a property in the store \"something.like.this\"\n// path splitted \"like.1.this\"\nreturn ParsedAction;}(SetRootFieldAction))||_class21);RuntimeAccessibleClass.set_extend(RuntimeAccessibleClass,Action);RuntimeAccessibleClass.set_extend(Action,LoadAction);RuntimeAccessibleClass.set_extend(Action,SetRootFieldAction);RuntimeAccessibleClass.set_extend(SetRootFieldAction,SetFieldAction);RuntimeAccessibleClass.set_extend(SetFieldAction,DeleteElementAction);RuntimeAccessibleClass.set_extend(Action,RedoAction);RuntimeAccessibleClass.set_extend(Action,UndoAction);RuntimeAccessibleClass.set_extend(Action,CreateElementAction);RuntimeAccessibleClass.set_extend(Action,CombineHistoryAction);RuntimeAccessibleClass.set_extend(Action,CompositeAction);RuntimeAccessibleClass.set_extend(SetRootFieldAction,ParsedAction);","map":{"version":3,"names":["Constructors","DPointerTargetable","DUser","Log","Pointers","RuntimeAccessible","RuntimeAccessibleClass","store","windoww","TransactionStatus","_classCallCheck","pendingActions","hasBegun","hasAborted","transactionDepthLevel","t","transactionStatus","BEGIN","ABORT","END","actionstoPrepend","arguments","length","undefined","concat","_toConsumableArray","console","error","FINAL_END","warn","ca","CompositeAction","fire","TRANSACTION","func","_len","params","Array","_key","apply","e","ee","window","maxActionFiring","Action","_dec","_class","_class2","_RuntimeAccessibleCla","_inherits","_super","_createSuper","field","value","subType","_Error$stack","_this","call","id","timestamp","sender","hasFired","consoleTargetSelector","type","stack","Date","now","maxCounter","current","constructor","Error","split","splice","className","cname","name","_createClass","key","forceRelaunch","__isProxy","action","push","_actions","storee","log","val","thiss","n","actions","dispatch","_objectSpread","parse1","ret","path","pathArray","executionCount","possibleInconsistencies","parse","isArray","map","fromJson","json","subclasses","_extends","SubType","LoadAction","_dec2","_class3","_class4","_Action","_super2","state","_this2","_new","create","SetRootFieldAction","_dec3","_class5","_class6","_Action2","_super3","fullpath","_this3","isPointer","doChecks","_get","_getPrototypeOf","prototype","accessModifier","create_old","tocheck","SetFieldAction","_dec4","_class7","_class8","_SetRootFieldAction","_super4","me","_this4","exDev","me_field","_this$me","d","from","RedoAction","_dec5","_class9","_class10","_Action3","_super5","_this5","amount","notfire","act","UndoAction","_dec6","_class11","_class12","_Action4","_super6","_this6","CombineHistoryAction","_dec7","_class13","_class14","_Action5","_super7","_this7","CreateElementAction","_dec8","_class15","_class16","_Action6","_super8","_this8","_this9","_derivedSubElements","_persistCallbacks","persist","newBatch","new","__raw","DeleteElementAction","_dec9","_class17","_class18","_SetFieldAction","_super9","_this10","_dec10","_class19","_class20","_Action7","_super10","_this11","launch","forceRelanch","ParsedAction","_dec11","_class21","_SetRootFieldAction2","_super11","_this12","_len2","args","_key3","set_extend"],"sources":["C:/d/Programming/web/jodel-mde/src/redux/action/action.ts"],"sourcesContent":["import {\r\n    Constructors,\r\n    Dictionary,\r\n    DocString,\r\n    DPointerTargetable,\r\n    DState,\r\n    DUser,\r\n    GObject,\r\n    Json,\r\n    Log,\r\n    LPointerTargetable,\r\n    orArr,\r\n    Pack1,\r\n    Pointer,\r\n    Pointers,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    store,\r\n    unArr,\r\n    windoww\r\n} from \"../../joiner\";\r\n\r\n// transactional-like start of storage modification\r\n// todo: nested transaction che conti quanti begin hai effettuato e crei una matrice di pendingActions una per ogni livello nested?\r\n\r\n/*\r\n// let nestedlevel: number = 0;\r\nclass NestedLevel{\r\n    level: number;\r\n    actions: Action[] = [];\r\n    up:NestedLevel[] = [];\r\n    down?:NestedLevel;\r\n\r\n    constructor(prevLevel?: NestedLevel, actions: Action[] = []) {\r\n        // this.prev = prev;\r\n        this.down = prevLevel;\r\n        this.actions = actions;\r\n        this.level = prevLevel ? prevLevel.level + 1 : 0;\r\n    }\r\n\r\n    add1(a:Action){ this.actions.push(a); }\r\n    add(a:Action[]){ this.actions.push(...a); }\r\n    push(actions:Action[]=[]){\r\n        this.up.push(new NestedLevel(this, actions));\r\n    }\r\n}\r\n// @Singleton\r\nclass NestedTransactionManager{\r\n    // private levels: NestedLevel[] = [];\r\n    public currentLevel?: NestedLevel;\r\n    // simple array is not good i can have spikes as russian mountains going up and down in deepness it's kinda a matrix or a pile of dishes like below'\r\n\r\n\r\n    /*\r\n    todo: to debug missing END paired with a begin, seve stack trace of begins and ends\r\n    * every level must have his own array?\r\n    * Begin0, Begin1, Begin2, End2, End1, Begin1.1 Begin 1.2....\r\n    it's a tree!\r\n    *\r\n    *\r\n    * ______begin lv2                              _______Begin1.2\r\n    * _________________________begin lv1           ___________________Begin1.1\r\n    * ____________________________________________________________________________________________________ a begin lv0\r\n    * * /\r\n    constructor() {}\r\n    begin(actions: Action[]=[]): void { this.pushLevel(actions); }\r\n    pushLevel(actions: Action[]=[]): void {\r\n        if (!this.currentLevel) { this.currentLevel = new NestedLevel(undefined, actions); return; }\r\n        this.currentLevel.push(actions); }\r\n    end(){\r\n        if (!this.currentLevel) return this.finalEnd();\r\n        this.currentLevel = this.currentLevel?.down; }\r\n    finalEnd(){\r\n\r\n    }\r\n    // current(): NestedLevel { return this.currentLevel; }\r\n    addActions(a:Action[]): void { this.currentLevel!.add(a); }\r\n    addAction(a:Action): void { this.currentLevel!.add1(a); }\r\n}\r\nlet transactionmanager = new NestedTransactionManager();\r\nfunction BEGIN2(){\r\n    transactionmanager.pushLevel();\r\n}\r\nfunction ABORT2(){\r\n    transactionmanager.end();\r\n}\r\nfunction END2(){\r\n\r\n}*/\r\n\r\nclass TransactionStatus{\r\n    pendingActions: Action[] = [];\r\n    hasBegun: boolean = false;\r\n    hasAborted: boolean = false;\r\n    transactionDepthLevel: number = 0;\r\n}\r\nlet t = new TransactionStatus();\r\nwindoww.transactionStatus = t;\r\n\r\nexport function BEGIN() {\r\n    t.hasBegun = true; // redundant but actions are reading this, minimize changes\r\n    t.transactionDepthLevel++;\r\n}\r\nexport function ABORT() {\r\n    t.hasAborted = true; // at any depth level since i have only a flat TRANSACTION array\r\n    END();\r\n}\r\nexport function END(actionstoPrepend: Action[] = []): boolean {\r\n    t.transactionDepthLevel--;\r\n    if (actionstoPrepend.length) t.pendingActions = [...actionstoPrepend, ...t.pendingActions];\r\n\r\n    if (t.transactionDepthLevel < 0) { console.error(\"mismatching END()\"); t.transactionDepthLevel = 0; }\r\n    if (t.transactionDepthLevel === 0) return FINAL_END();\r\n    return false;\r\n}\r\nexport function FINAL_END(): boolean{\r\n    console.warn(\"FINAL_END\");\r\n    t.hasBegun = false;\r\n    // pendingActions.sort( (a, b) => a.timestamp - b.timestamp)\r\n    if (t.hasAborted) {\r\n        t.pendingActions = [];\r\n        t.hasAborted = false;\r\n        return false;\r\n    }\r\n    const ca: CompositeAction = new CompositeAction(t.pendingActions, false);\r\n    t.pendingActions = [];\r\n    return ca.fire();\r\n}\r\ntype NotPromise<T> = T extends Promise<any> ? never : T;\r\n\r\ntype NoAsyncFn<\r\n    T extends (...args: any)=>any,\r\n    ReturnsPromise extends (...args: any)=>any = ReturnType<T> extends Promise<any> ? never:T\r\n    >=ReturnsPromise;\r\n// make class isinstorage e mettici il path studia annotazioni per annotare gli oggett in modo che vengano rwappati prima di farli ritornare se sono annotati\r\n// minor todo: type as (...args: infer P) => any) ?\r\n// NB: cannot be async, it changes execution order and break many codes where return value is determined in a transaction.\r\n// also because BEGIN() becomes stuck and actions cannot fire until the server replies or times out.\r\nexport function TRANSACTION<F extends (...args: any)=>any>(func: NoAsyncFn<F>, ...params: Parameters<F>): boolean | DState {\r\n//export function TRANSACTION<F extends NoAsyncFn)>(func: F, ...params: Parameters<F>): boolean | DState {\r\n    BEGIN();\r\n    // minor todo: potrei fare l'override di Error() per fare in modo che gli errori vengano presi anche se non uso TRANSACTION o try-catch ?\r\n    try { func(...params); } catch(e) { Log.ee('Transaction failed:', e); ABORT(); return false; }\r\n    return END();\r\n}\r\n(window as any).TRANSACTION = TRANSACTION;\r\n(window as any).BEGIN = BEGIN;\r\n(window as any).ABORT = ABORT;\r\n(window as any).END = END;\r\n(window as any).FINAL_END = FINAL_END;\r\n(window as any).maxActionFiring = 0;\r\n\r\n// todo: ma non so come, fare in modo che [], +=, -=, siano disponibili solo se la chiave è il nome di un attributo di tipo array\r\ntype arrayFieldNameTypes<D> = keyof D | `${string & keyof D}[]` | `${string & keyof D}+=` | `${string & keyof D}-=` | `${string & keyof D}.${number}` | `${string & keyof D}[${number}]`;\r\ntype AccessModifier = '' | '[]' | '+=' | '-=' | `.${number}` | `[${number}]` | undefined;\r\ntype StrictExclude<T, U> = T extends U ? U extends T ? never : T : T;\r\n\r\n@RuntimeAccessible('Action')\r\nexport class Action extends RuntimeAccessibleClass {\r\n    public static cname: string = \"Action\";\r\n    public static maxCounter: number = 1;\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static type = 'ACTION';\r\n    static SubType: {\r\n        vertexSubElements: 'vertexSubElements',\r\n        vertexSize: 'vertexSize'\r\n    };\r\n    field: string;\r\n    value: any;\r\n    id: Pointer;\r\n    timestamp: number;\r\n    sender: Pointer<DUser, 0, 1>;\r\n    hasFired: number = 0;\r\n    // targetID: string | undefined;\r\n    // target: IClass = null as any;\r\n    consoleTargetSelector: string = '';\r\n    // field: string = ''; // es: ID_58\r\n    // value: any; // es: lowerbound, name, namespace, values (for attrib-ref)...\r\n    type: string;\r\n    // private src?: string[];\r\n    subType?: string; //?\r\n    private stack?: string[];\r\n    protected constructor(field: string, value: any, subType?: string) {\r\n        super();\r\n        this.id = 'Action_' + Date.now() + \"_\" + Action.maxCounter++; // NB: the prefix must be the same for all actions because it must not affect order\r\n        this.timestamp = Date.now();\r\n        this.sender = DUser.current;\r\n        this.field = field;\r\n        this.value = value;\r\n        this.type = (this.constructor as any).type;\r\n        this.stack = new Error().stack?.split('\\n').splice( 4);\r\n        this.subType = subType;\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n\r\n    fire(forceRelaunch: boolean = false): boolean {\r\n        if (this.hasFired && !forceRelaunch) return false;\r\n        if (this.value && this.value.__isProxy) {\r\n            Log.ee(\"Attempted to set a proxy object inside the store.\", {action:this, value: this.value});\r\n            return false;\r\n        }\r\n        this.hasFired++;\r\n        if (t.hasBegun) {\r\n            t.pendingActions.push(this);\r\n        } else {\r\n            // if ((window as any).maxActionFiring++ >= 400) return false;\r\n            let storee = store || windoww.store;\r\n            console.log('firing action:', {\r\n                field: this.field,\r\n                val: this.value,\r\n                // stack:this.src,\r\n                thiss:this,\r\n                n:(this as any).actions?.length || 1\r\n            });\r\n            storee.dispatch({...this});\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public static possibleInconsistencies: Dictionary<DocString<'subtype'>, Pointer[]> = {};\r\n    private static parse1(action: Action): ParsedAction {\r\n        const ret: ParsedAction = action as any;\r\n        ret.path = action.field; // normalize the path\r\n        ret.pathArray = ret.path.split('.');\r\n        ret.executionCount = 0;\r\n        if (!action.subType) return ret;\r\n        if (!Action.possibleInconsistencies[action.subType]) Action.possibleInconsistencies[action.subType] = [ action.value ];\r\n        else Action.possibleInconsistencies[action.subType].push(action.value);\r\n        return ret;\r\n    }\r\n\r\n    static parse<T extends Action | Action[], RET extends T extends any[] ? ParsedAction[] : ParsedAction>(actions: T): RET {\r\n        if ((actions as Action).className === CompositeAction.cname) throw new Error(\"Composite action cannot be parsed directly, parse composite.actions instead\");\r\n        if (!Array.isArray(actions)) return Action.parse1(actions) as RET;\r\n        return actions.map( Action.parse1 ) as RET;\r\n    }\r\n\r\n    static fromJson(json: Json): Action{\r\n        let action = new Action('dummy', 'dummy');\r\n        for(let key in action) delete (action as GObject)[key]; // resetting the action\r\n        for(let key in json) (action as any)[key] = json[key];\r\n        return action;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('LoadAction')\r\nexport class LoadAction extends Action {\r\n    public static cname: string = \"LoadAction\";\r\n    static type = 'LOAD';\r\n    static new(state: DState | GObject): boolean { return state && new LoadAction(state).fire(); }\r\n    static create(state: DState | GObject): LoadAction { return state && new LoadAction(state); }\r\n\r\n    constructor(state: DState | GObject, fire: boolean = true) {\r\n        super('', state, '');\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n        if (fire) this.fire();\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('SetRootFieldAction')\r\nexport class SetRootFieldAction extends Action {\r\n    public static cname: string = \"SetRootFieldAction\";\r\n    static subclasses: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static _extends: (typeof RuntimeAccessibleClass | string)[] = [];\r\n    static type = 'SET_ROOT_FIELD';\r\n    isPointer: boolean;\r\n\r\n    static create(fullpath: string, val: string | string[], accessModifier: AccessModifier | undefined, isPointer: boolean): SetRootFieldAction;\r\n    static create<\r\n        VAL extends any,\r\n        PATH extends VAL extends string | string[] ? 'must specify \"isPointer\" parameter' : string,\r\n        // VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        /*VAL extends (AM extends undefined | '' ? (D[T] extends any[] ? StrictExclude<D[T], string[]> : StrictExclude<D[T], string>) :\r\n            (AM extends '-=' ?\r\n                number[] :\r\n                (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<StrictExclude<D[T], string>> | StrictExclude<D[T], string> | (StrictExclude<D[T], string>)[] : '_error_'))),\r\n        */\r\n        ISPOINTER extends boolean,\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(fullpath: PATH, val: VAL, accessModifier?: AM | undefined, isPointer?: ISPOINTER): SetRootFieldAction;\r\n    static create<\r\n        T extends string,\r\n        VAL extends any,\r\n        ISPOINTER extends boolean,\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(fullpath: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): SetRootFieldAction {\r\n        if (accessModifier) (fullpath as any) += accessModifier;\r\n        return new SetRootFieldAction(fullpath, val, false, isPointer);\r\n    }\r\n    static new(...a:Parameters<(typeof SetRootFieldAction)[\"create\"]>): boolean{ return SetRootFieldAction.create(...a).fire();}\r\n\r\n    protected constructor(fullpath: string, value: any = undefined, fire: boolean = true, isPointer: boolean = false) {\r\n        super(fullpath, value, undefined);\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n        this.isPointer = isPointer;\r\n        if (fire) this.fire();\r\n    }\r\n\r\n    static create_old<\r\n        T extends string,\r\n        VAL extends any,\r\n        ISPOINTER extends boolean,\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(tocheck:never, fullpath: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): SetRootFieldAction {\r\n        return new SetRootFieldAction(fullpath + (accessModifier || ''), val, false, isPointer);\r\n    }\r\n    fire(forceRelaunch: boolean = false, doChecks: boolean = true): boolean {\r\n        /* no need, the reducer should return old state in this case. verify it!\r\n        if (doChecks) {\r\n            // if action would not change the value, i don't fire it at all\r\n            let s: GObject<DState> = store.getState();\r\n            let field = (this.field||'');\r\n            let accessOperator: string = field.substring(field.length-2);\r\n            let fieldpath: string[] = field.split(\".\");\r\n            switch(accessOperator){\r\n                default:\r\n                case \"-=\":\r\n                case \"+=\":\r\n            }\r\n            // path can end with -=, +=, [] etc, but it's fine if i check it as if it was part of the name like object[\"fieldname+=\"]\r\n            // because in all those cases\r\n            if (s[this.field] === this.value) return false;\r\n        }*/\r\n        return super.fire(forceRelaunch);\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('SetFieldAction')\r\nexport class SetFieldAction extends SetRootFieldAction {\r\n    static type = 'SET_ME_FIELD';\r\n\r\n    static create<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        VAL extends\r\n            D[T] extends string | string[] ? 'must specify \"isPointer\" parameter' :\r\n                (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        // VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        /*VAL extends (AM extends undefined | '' ? (D[T] extends any[] ? StrictExclude<D[T], string[]> : StrictExclude<D[T], string>) :\r\n            (AM extends '-=' ?\r\n                number[] :\r\n                (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<StrictExclude<D[T], string>> | StrictExclude<D[T], string> | (StrictExclude<D[T], string>)[] : '_error_'))),\r\n        */\r\n        ISPOINTER extends boolean | \"todo: ISPOINTER type = boolean but required only if val is UnArr< string > = string | string[], maybe do with override\",\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(me: D | Pointer<D>,\r\n          field: T,\r\n          val: VAL,\r\n          accessModifier?: AM | undefined,\r\n          isPointer?: ISPOINTER): SetFieldAction;\r\n    static create<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        VAL extends AM extends '' | undefined ? orArr<string | null | undefined> :\r\n            (AM extends '-=' ? orArr<number> :\r\n                (AM extends '+=' ? orArr<string | null | undefined> : '_am_typeerror_')),\r\n        AM extends AccessModifier | undefined = undefined,\r\n        >(me: D | Pointer<D>, field: T,\r\n          val: VAL,\r\n          accessModifier: AM,\r\n          isPointer: boolean): SetFieldAction;\r\n    static create<\r\n        D extends DPointerTargetable,\r\n        T extends string & (keyof D),\r\n        VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        ISPOINTER extends boolean | \"todo: ISPOINTER type = boolean but required only if val is UnArr< string > = string | string[], maybe do with override\",\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(me: D | Pointer<D>, field: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): SetFieldAction {\r\n        if (accessModifier) (field as any) += accessModifier;\r\n        return new SetFieldAction(me, field, val, false, isPointer as boolean);\r\n    }\r\n\r\n\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        VAL extends\r\n            D[T] extends string | string[] ? 'must specify \"isPointer\" parameter' :\r\n                (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        // VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        /*VAL extends (AM extends undefined | '' ? (D[T] extends any[] ? StrictExclude<D[T], string[]> : StrictExclude<D[T], string>) :\r\n            (AM extends '-=' ?\r\n                number[] :\r\n                (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<StrictExclude<D[T], string>> | StrictExclude<D[T], string> | (StrictExclude<D[T], string>)[] : '_error_'))),\r\n        */\r\n        ISPOINTER extends boolean | \"todo: ISPOINTER type = boolean but required only if val is UnArr< string > = string | string[], maybe do with override\",\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(me: D | Pointer<D>,\r\n          field: T,\r\n          val: VAL,\r\n          accessModifier?: AM | undefined,\r\n          isPointer?: ISPOINTER): boolean;\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends (keyof D),\r\n        VAL extends AM extends '' | undefined ? orArr<string | null | undefined> :\r\n            (AM extends '-=' ? orArr<number> :\r\n                (AM extends '+=' ? orArr<string | null | undefined> : '_am_typeerror_')),\r\n        AM extends AccessModifier | undefined = undefined,\r\n        >(me: D | Pointer<D>, field: T,\r\n          val: VAL,\r\n          accessModifier: AM,\r\n          isPointer: boolean): boolean;\r\n    static new<\r\n        D extends DPointerTargetable,\r\n        T extends string & (keyof D),\r\n        VAL extends (AM extends undefined | '' ? D[T] : (AM extends '-=' ? number[] : (AM extends '+=' | '[]' | `[${number}]` | `.${number}` ? unArr<D[T]> | D[T] | D[T][] : '_error_'))),\r\n        ISPOINTER extends boolean | \"todo: ISPOINTER type = boolean but required only if val is UnArr< string > = string | string[], maybe do with override\",\r\n        AM extends AccessModifier | undefined = undefined,\r\n        // T extends arrayFieldNameTypes<D> = any\r\n        >(me: D | Pointer<D>, field: T, val: VAL, accessModifier: AM | undefined = undefined, isPointer?: ISPOINTER): boolean {\r\n        if (accessModifier) (field as any) += accessModifier;\r\n        return new SetFieldAction(me, field, val, false, isPointer as boolean).fire();\r\n    }\r\n\r\n\r\n\r\n    me: Pointer | DPointerTargetable;\r\n    me_field: string;\r\n    // field can end with \"+=\", \"[]\", or \"-1\" if it's array\r\n    protected constructor(me: DPointerTargetable | Pointer, field: string, val: any, fire: boolean = true, isPointer: boolean = false) {\r\n        Log.exDev(!me, 'BaseObject missing in SetFieldAction', {me, field, val});\r\n        super('idlookup.' + ((me as DPointerTargetable).id || me) + ( field ? '.' + field : ''), val, false, isPointer);\r\n        this.me = me;\r\n        this.me_field = field;\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n        if (fire) this.fire();\r\n    }\r\n\r\n    fire(forceRelaunch: boolean = false): boolean {\r\n        // if action would not change the value, i don't fire it at all\r\n        // by id because if item was updated, this.me as DElement might be an old version, different from the one in store.\r\n        let d: GObject<any> = DPointerTargetable.from((this.me as DPointerTargetable)?.id || this.me as any);\r\n        // console.warn(\"me fire\", {thiss:this, d, typeofd:typeof d, field:this.me_field, dfield:d[this.me_field], val:this.value});\r\n        if (d && typeof d === \"object\" && d[this.me_field] === this.value) return false;\r\n        return super.fire(forceRelaunch, false);\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n/*\r\ncould put in documentation\r\nlet dclass: DClass = null as any;\r\nSetFieldAction.new(dclass, 'namek', '') // non è un attributo di \"DCLass\"\r\nSetFieldAction.new(dclass, 'parent', '') // val (stringa) non è assegnabile a parent (array di puntatori)\r\nSetFieldAction.new(dclass, 'name.5k', '') // non è un indice array valido\r\nSetFieldAction.new(dclass, 'name[4k]', '') // non è un indice array valido\r\nSetFieldAction.new(dclass, 'name[4]', '') // ok, anche se non dovrebbe accettare la dicitura array per name che è un primitivo (check non implementato, troppo difficile)\r\nSetFieldAction.new(dclass, 'name.5', '') // ok, equivale a dicitura array\r\n*/\r\n\r\n@RuntimeAccessible('RedoAction')\r\nexport class RedoAction extends Action {\r\n    public static cname: string = \"RedoAction\";\r\n    static type = 'RedoAction';\r\n    public static new<F extends boolean = true>(amount: number = 1, notfire?: F): (F extends false ? boolean : RedoAction) {\r\n        let act = new RedoAction(amount);\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor(amount: number = 1) {\r\n        super('', amount);\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('UndoAction')\r\nexport class UndoAction extends Action {\r\n    public static cname: string = \"UndoAction\";\r\n    static type = 'UndoAction';\r\n    public static new<F extends boolean = true>(amount: number = 1, notfire?: F): (F extends false ? boolean : UndoAction) {\r\n        let act = new UndoAction(amount);\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor(amount: number = 1) {\r\n        super('', amount);\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n}\r\n\r\n// todo: delete or find original idea back\r\n@RuntimeAccessible('CombineHistoryAction')\r\nexport class CombineHistoryAction extends Action {\r\n    public static cname: string = \"CombineHistoryAction\";\r\n    static type = 'CombineHistoryAcCombineHistoryActiontion';\r\n    public static new<F extends boolean = true>(notfire?: F): (F extends false ? boolean : CombineHistoryAction) {\r\n        let act = new CombineHistoryAction();\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor() {\r\n        super('', '');\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('CreateElementAction')\r\nexport class CreateElementAction extends Action {\r\n    public static cname: string = \"CreateElementAction\";\r\n    static type = 'CREATE_ELEMENT';\r\n    value!: DPointerTargetable;\r\n    public static newBatch<F extends boolean = true>(me: DPointerTargetable[], notfire?: F): (F extends false ? boolean : CreateElementAction)[]{\r\n        let ret: any[] = [];\r\n        TRANSACTION(()=>(ret = me.map( (e) => CreateElementAction.new(e, notfire))));\r\n        return ret;\r\n    }\r\n\r\n    public static create<F extends boolean = true>(me: DPointerTargetable): CreateElementAction {\r\n        if ((me as LPointerTargetable).__raw) me = (me as LPointerTargetable).__raw;\r\n        return new CreateElementAction(me, true);\r\n    }\r\n    public static new<F extends boolean = true>(me: DPointerTargetable, notfire?: F): (F extends false ? boolean : CreateElementAction) {\r\n        let act = CreateElementAction.create(me);\r\n        if (!notfire) return act.fire() as any;\r\n        return act as any;\r\n    }\r\n    private constructor(me: DPointerTargetable, fire: boolean = true) {\r\n        super('idlookup.' + me.id, me);\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n        this.value = me;\r\n        if (fire) this.fire();\r\n    }\r\n    public fire(forceRelaunch: boolean = false): boolean {\r\n        let ret = false;\r\n        TRANSACTION( () => {\r\n            ret = super.fire(forceRelaunch);\r\n            if (this.value._derivedSubElements || this.value._persistCallbacks) { Constructors.persist(this.value, true); }\r\n        });\r\n        return ret;\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('DeleteElementAction')\r\nexport class DeleteElementAction extends SetFieldAction {\r\n    static type = 'DELETE_ELEMENT';\r\n    public static create(me: Pack1<LPointerTargetable>): DeleteElementAction { return new DeleteElementAction(me as any); }\r\n    public static new(me: Pack1<LPointerTargetable>): boolean { return new DeleteElementAction(me as any).fire(); }\r\n\r\n    constructor(me: Pack1<LPointerTargetable>) {\r\n        super(Pointers.from(me), '', undefined);\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n}\r\n\r\n\r\n/*\r\n\r\n@RuntimeAccessible\r\nexport class IDLinkAction extends Action{\r\n    constructor() {\r\n        super(IDLinkAction.name,\r\n    }\r\n    nope, uso un proxy\r\n}*/\r\n\r\n@RuntimeAccessible('CompositeAction')\r\nexport class CompositeAction extends Action {\r\n    static type: string = 'COMPOSITE_ACTION';\r\n    actions: Action[] = [];\r\n\r\n    public static new(actions: Action[], launch: boolean = true): CompositeAction { return new CompositeAction(actions, launch); }\r\n    constructor(actions: Action[], launch: boolean = false) {\r\n        super('', '');\r\n        this.actions = actions;\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n        if (launch) this.fire();\r\n    }\r\n    fire(forceRelanch?: boolean): boolean{\r\n        if (!this.actions.length) return false;\r\n        return super.fire(forceRelanch);\r\n    }\r\n}\r\n\r\n@RuntimeAccessible('ParsedAction')\r\nexport class ParsedAction extends SetRootFieldAction {\r\n    // NB: actually this is never created but \"converted\" from other actions by adding fields\r\n    path!: string; // path to a property in the store \"something.like.this\"\r\n    pathArray!: string[]; // path splitted \"like.1.this\"\r\n    executionCount!: number;\r\n}\r\n\r\n\r\nRuntimeAccessibleClass.set_extend(RuntimeAccessibleClass, Action);\r\nRuntimeAccessibleClass.set_extend(Action, LoadAction);\r\nRuntimeAccessibleClass.set_extend(Action, SetRootFieldAction);\r\nRuntimeAccessibleClass.set_extend(SetRootFieldAction, SetFieldAction);\r\nRuntimeAccessibleClass.set_extend(SetFieldAction, DeleteElementAction);\r\nRuntimeAccessibleClass.set_extend(Action, RedoAction as any);\r\nRuntimeAccessibleClass.set_extend(Action, UndoAction as any);\r\nRuntimeAccessibleClass.set_extend(Action, CreateElementAction as any);\r\nRuntimeAccessibleClass.set_extend(Action, CombineHistoryAction as any);\r\nRuntimeAccessibleClass.set_extend(Action, CompositeAction as any);\r\nRuntimeAccessibleClass.set_extend(SetRootFieldAction, ParsedAction as any);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
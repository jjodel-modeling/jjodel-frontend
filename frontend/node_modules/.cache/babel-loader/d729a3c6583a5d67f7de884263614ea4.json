{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";var _dec,_class,_class2;import{EcoreParser,LoadAction,Log,U,LPointerTargetable,prjson2xml,prxml2json,store,RuntimeAccessible,Selectors,Debug,DViewElement,transientProperties}from'../../joiner';export var SaveManager=(_dec=RuntimeAccessible('SaveManager'),_dec(_class=(_class2=/*#__PURE__*/function(){function SaveManager(){_classCallCheck(this,SaveManager);}_createClass(SaveManager,null,[{key:\"save\",value:function save(){SaveManager.tmpsave=store.getState();localStorage.setItem(\"tmpsave\",JSON.stringify(SaveManager.tmpsave));console.clear();console.log(JSON.stringify(SaveManager.tmpsave));}},{key:\"load\",value:function load(state){if(!state&&SaveManager.tmpsave){LoadAction.new(SaveManager.tmpsave);return;}state=state||localStorage.getItem('tmpsave')||'null';// priorities: 1) argument from file 2) state variable cached 3) localstorage 4) null prevent crash\nvar save=SaveManager.tmpsave=JSON.parse(state);for(var _i=0,_arr=[].concat(_toConsumableArray(save.viewelements),_toConsumableArray(save.viewpoints));_i<_arr.length;_i++){var vid=_arr[_i];var _iterator=_createForOfIteratorHelper(DViewElement.RecompileKeys),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _save$idlookup$vid;var key=_step.value;if(!transientProperties.view[vid])transientProperties.view[vid]={name:((_save$idlookup$vid=save.idlookup[vid])===null||_save$idlookup$vid===void 0?void 0:_save$idlookup$vid.name)||'Unnamed'};key='VIEWS_RECOMPILE_'+key;if(!save[key])save[key]=[];save[key].push(vid);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}LoadAction.new(save);}},{key:\"exportEcore_click\",value:function exportEcore_click(){var _lmodel$instanceof;var toXML=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var toFile=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;// e: React.MouseEvent,\nvar lmodel=Selectors.getActiveModel();if(!lmodel)return;var json=SaveManager.exportEcore(lmodel);var str=JSON.stringify(json,null,\"\\t\");if(toXML){str=prjson2xml.json2xml(json,'\\t');str=U.formatXml(str);}if(!toFile){// (document.querySelector(\"#export-tmp\") as any).innerText = str;\nlocalStorage.setItem(\"import\",str);return;}var ism2=lmodel.isMetamodel;var name=(lmodel.name||(ism2?'M2':'M1')+'_unnamed')+(toXML?\".xml\":'.json')+\".\"+(ism2?\"ecore\":((_lmodel$instanceof=lmodel.instanceof)===null||_lmodel$instanceof===void 0?void 0:_lmodel$instanceof.name)||\"shapeless\");console.log(\"download file:\",{name:name,ism2:ism2,toXML:toXML,lmodel:lmodel,instanceof:lmodel.instanceof});U.download(name,str);}},{key:\"importEcore_click\",value:function importEcore_click(){var fromXML=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromfile=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;try{this.importEcore_click0(fromXML,fromfile);}catch(e){var _e$message,_e$message$substring;var str=(e===null||e===void 0?void 0:(_e$message=e.message)===null||_e$message===void 0?void 0:(_e$message$substring=_e$message.substring)===null||_e$message$substring===void 0?void 0:_e$message$substring.call(_e$message,0,1000))||'some error';console.trace(str,e);// throw new Error(str);\n}}},{key:\"importEcore_click0\",value:function importEcore_click0(){var fromXML=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromfile=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var extensions=[fromXML?\"*.xml.*\":\"*.json.*\"];// [\".ecore\"]; // Selectors.getActiveModel().isM1() ? '.' + Selectors.getActiveModel().metamodel.fullname() : '.ecore';\nvar filestring,jsonstring,jsonobj=undefined;console.log(\"importEcore: prefromfile\");if(!fromfile){filestring=localStorage.getItem(\"import\")||'null';if(fromXML){var xmlDoc=new DOMParser().parseFromString(filestring,\"text/xml\");jsonobj=prxml2json.xml2jsonobj(xmlDoc,' ');}//if (filestring.includes(\"\\n\")) throw new Error(filestring.substring(0, 1000));\nSaveManager.importEcore(jsonobj||filestring,true,undefined,true);// todo: trova il modo di determinare se è m1 o m2 senza filename\nreturn;}console.log(\"importEcore: pre file read\",{fromXML:fromXML,fromfile:fromfile});var filename;U.fileRead(function(e,files,fileContents){var _e$target$files;Log.ex(!fileContents||!files||fileContents.length!==files.length,'Failed to get file contents:',files,fileContents);Log.ex(fileContents&&fileContents.length>1,'Should not be possible to input multiple files yet.');if(!fileContents)return;if(fileContents.length==0)return;// @ts-ignore\nfilename=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0].name;console.log(\"file read\",{e:e,fileContents:fileContents,files:files,filename:filename});filestring=fileContents[0];// if file is over 500kb, lightmode on\nif(filestring.length>=500*1024&&!Debug.lightMode){Debug.setLightMode(true);// $(document).one(\"click\", (e) => { Debug.setLightMode(false); });\n}console.log('importEcore filestring input: ',filestring);if(fromXML){var windoww=window;windoww.file=filestring;windoww.todoc=function(str){return new DOMParser().parseFromString(str,\"text/xml\");};windoww.doctojson=function(doc){return prxml2json.xml2jsonobj(doc,' ');};// problemi doctojson or xmi parser: \\n replacemet causa crash per stringa in posizione invalida. \\\" anche per attributi inline che iniiano con \\\\\"\n// filestring = U.multiReplaceAll(filestring, [\"\\t\", \"\\r\", \"\\n\", '&amp;', '&#38;', '&quot;', '&', '\\'', '\"'], [\"\\\\t\", \"\\\\r\", \"\\\\n\", '\\\\&', \"\\\\'\", '\\\\\"', '\\\\&', \"\\\\'\", '\\\\\"']);//,  \"\\\\t\"), \"\\r\", \"\\\\r\"), \"\\n\", \"\\\\n\");\nvar _xmlDoc=new DOMParser().parseFromString(filestring,\"text/xml\");console.log('importEcore xml:',_xmlDoc);var jsonstring0='';jsonobj=prxml2json.xml2jsonobj(_xmlDoc,' ');//doto: non devo wrappare con \\\" i nomi di chiavi o valori ma solo i contenuti\n/*jsonstring = jsonstring0;\r\n                //jsonstring = U.multiReplaceAll(jsonstring0, [\"\\t\", \"\\r\", \"\\n\", '&amp;', '&#38;', '&quot;', '&', '\\'', '\"'], [\"\\\\t\", \"\\\\r\", \"\\\\n\", '\\\\&', \"\\\\'\", '\\\\\"', '\\\\&', \"\\\\'\", '\\\\\"']);//,  \"\\\\t\"), \"\\r\", \"\\\\r\"), \"\\n\", \"\\\\n\");\r\n                */ //jsonstring = jsonstring.replaceAll(/(\\{|\\,)\\\\n\\s*/gm, \"\")\n/*if (jsonstring.includes(\"\\n\")) throw new Error(jsonstring0.substring(0, 1000)+\"\\n\\n\\n\\n\" + jsonstring.substring(0, 1000));\r\n                */ // jsonstring = JSON.stringify(jsonobj);\nif(jsonobj.parsererror){Log.e(\"failed to parse XML->JSON\",{parseError:jsonobj.parseerror,jsonobj:jsonobj});return;}console.log('importEcore jsonstr input: ',jsonobj);}else jsonstring=filestring;var isMetamodel=filename.indexOf(\".ecore\")===filename.length-\".ecore\".length;console.log(\"ismetamodel\",{filename:filename,isMetamodel:isMetamodel});var end=SaveManager.importEcore(jsonobj||jsonstring||'null',isMetamodel,filename,true);},extensions,true);}},{key:\"exportEcore\",value:function exportEcore(model){var loopobj={};try{return model.generateEcoreJson(loopobj);}catch(e){Log.exx(\"possible loop in model:\\t\\n\"+e.message,{loopobj:loopobj,e:e});}return{\"error\":true,loopobj:loopobj};}},{key:\"importEcore\",value:function importEcore(jsonstr,isMetamodel,filename){var persist=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return EcoreParser.parse(jsonstr,isMetamodel,filename,persist);}},{key:\"exportLayout_click\",value:function exportLayout_click(toFile){var lmodel=LPointerTargetable.wrap(store.getState().models[0]);// lmodel.node?.allSubNodes\n}},{key:\"importLayout_click\",value:function importLayout_click(fromFile){}}]);return SaveManager;}(),_class2.tmpsave=void 0,_class2))||_class);","map":{"version":3,"names":["EcoreParser","LoadAction","Log","U","LPointerTargetable","prjson2xml","prxml2json","store","RuntimeAccessible","Selectors","Debug","DViewElement","transientProperties","SaveManager","_dec","_class","_class2","_classCallCheck","_createClass","key","value","save","tmpsave","getState","localStorage","setItem","JSON","stringify","console","clear","log","load","state","new","getItem","parse","_i","_arr","concat","_toConsumableArray","viewelements","viewpoints","length","vid","_iterator","_createForOfIteratorHelper","RecompileKeys","_step","s","n","done","_save$idlookup$vid","view","name","idlookup","push","err","e","f","exportEcore_click","_lmodel$instanceof","toXML","arguments","undefined","toFile","lmodel","getActiveModel","json","exportEcore","str","json2xml","formatXml","ism2","isMetamodel","instanceof","download","importEcore_click","fromXML","fromfile","importEcore_click0","_e$message","_e$message$substring","message","substring","call","trace","extensions","filestring","jsonstring","jsonobj","xmlDoc","DOMParser","parseFromString","xml2jsonobj","importEcore","filename","fileRead","files","fileContents","_e$target$files","ex","target","lightMode","setLightMode","windoww","window","file","todoc","doctojson","doc","jsonstring0","parsererror","parseError","parseerror","indexOf","end","model","loopobj","generateEcoreJson","exx","jsonstr","persist","exportLayout_click","wrap","models","importLayout_click","fromFile"],"sources":["C:/d/Programming/web/jodel-mde/src/components/topbar/SaveManager.ts"],"sourcesContent":["import {\r\n    Dictionary, DUser,\r\n    EcoreParser, GObject, DState,\r\n    Json,\r\n    LModel,\r\n    LoadAction,\r\n    Log, U,\r\n    LPointerTargetable, prjson2xml, prxml2json,\r\n    store, RuntimeAccessible, DModelElement, SetRootFieldAction, Selectors, Debug, DViewElement, transientProperties\r\n} from '../../joiner';\r\n\r\n@RuntimeAccessible('SaveManager')\r\nexport class SaveManager {\r\n    private static tmpsave: DState;\r\n\r\n    static save(): void {\r\n        SaveManager.tmpsave = store.getState();\r\n        localStorage.setItem(\"tmpsave\", JSON.stringify(SaveManager.tmpsave));\r\n        console.clear();\r\n        console.log(JSON.stringify(SaveManager.tmpsave))\r\n    }\r\n\r\n    static load(state?: string): void {\r\n        if (!state && SaveManager.tmpsave) { LoadAction.new(SaveManager.tmpsave); return; }\r\n        state = state || localStorage.getItem('tmpsave') || 'null'; // priorities: 1) argument from file 2) state variable cached 3) localstorage 4) null prevent crash\r\n        let save: GObject<DState> = SaveManager.tmpsave = JSON.parse(state);\r\n        for (let vid of [...save.viewelements, ...save.viewpoints]) {\r\n            for (let key of DViewElement.RecompileKeys) {\r\n                if(!transientProperties.view[vid]) transientProperties.view[vid] = {name: (save.idlookup[vid] as any)?.name || 'Unnamed'} as any;\r\n                key = 'VIEWS_RECOMPILE_' + key;\r\n                if (!save[key]) save[key] = [];\r\n                save[key].push(vid);\r\n            }\r\n        }\r\n        LoadAction.new(save);\r\n    }\r\n\r\n    public static exportEcore_click(toXML: boolean = false, toFile: boolean = true): void { // e: React.MouseEvent,\r\n        let lmodel: null|LModel = Selectors.getActiveModel();\r\n        if (!lmodel) return;\r\n        let json = SaveManager.exportEcore(lmodel);\r\n        let str = JSON.stringify(json, null, \"\\t\");\r\n        if (toXML) {\r\n            str = prjson2xml.json2xml(json, '\\t');\r\n            str = U.formatXml(str);\r\n        }\r\n\r\n        if (!toFile) {\r\n            // (document.querySelector(\"#export-tmp\") as any).innerText = str;\r\n            localStorage.setItem(\"import\", str);\r\n            return;\r\n        }\r\n        let ism2 = (lmodel as LModel).isMetamodel;\r\n        let name = (lmodel.name || (ism2 ? 'M2' : 'M1') + '_unnamed')  + (toXML ? \".xml\" : '.json') + \".\"+ (ism2 ? \"ecore\" : lmodel.instanceof?.name || \"shapeless\");\r\n        console.log(\"download file:\", {name, ism2, toXML, lmodel, instanceof:lmodel.instanceof});\r\n        U.download(name, str);\r\n    }\r\n\r\n    public static importEcore_click(fromXML: boolean = false, fromfile: boolean = true): void {\r\n        try { this.importEcore_click0(fromXML, fromfile); } catch (e: any) {\r\n            let str = e?.message?.substring?.(0, 1000) || 'some error';\r\n            console.trace(str, e);\r\n            // throw new Error(str);\r\n        }\r\n    }\r\n    public static importEcore_click0(fromXML: boolean = false, fromfile: boolean = true): void {\r\n        const extensions: string[] = [(fromXML ? \"*.xml.*\" : \"*.json.*\")]; // [\".ecore\"]; // Selectors.getActiveModel().isM1() ? '.' + Selectors.getActiveModel().metamodel.fullname() : '.ecore';\r\n        let filestring: string, jsonstring: string, jsonobj: GObject = undefined as any;\r\n        console.log(\"importEcore: prefromfile\");\r\n        if (!fromfile) {\r\n            filestring = localStorage.getItem(\"import\") || 'null';\r\n            if (fromXML) {\r\n                const xmlDoc = new DOMParser().parseFromString(filestring,\"text/xml\");\r\n                jsonobj = prxml2json.xml2jsonobj(xmlDoc, ' ');\r\n            }\r\n            //if (filestring.includes(\"\\n\")) throw new Error(filestring.substring(0, 1000));\r\n            SaveManager.importEcore(jsonobj || filestring, true, undefined, true); // todo: trova il modo di determinare se è m1 o m2 senza filename\r\n            return; }\r\n\r\n        console.log(\"importEcore: pre file read\", {fromXML, fromfile});\r\n        let filename;\r\n        U.fileRead((e: Event, files?: FileList | null, fileContents?: string[]) => {\r\n            Log.ex(!fileContents || !files || fileContents.length !== files.length, 'Failed to get file contents:', files, fileContents);\r\n            Log.ex(fileContents && fileContents.length > 1, 'Should not be possible to input multiple files yet.');\r\n            if (!fileContents) return;\r\n            if (fileContents.length == 0) return;\r\n            // @ts-ignore\r\n            filename = e.target.files?.[0].name;\r\n            console.log(\"file read\", {e, fileContents, files, filename});\r\n            filestring = fileContents[0];\r\n\r\n            // if file is over 500kb, lightmode on\r\n            if (filestring.length >= 500*1024 && !Debug.lightMode) {\r\n                Debug.setLightMode(true);\r\n                // $(document).one(\"click\", (e) => { Debug.setLightMode(false); });\r\n            }\r\n\r\n            console.log('importEcore filestring input: ', filestring);\r\n            if (fromXML) {\r\n                let windoww = window as any;\r\n                windoww.file = filestring;\r\n                windoww.todoc = (str: any) => new DOMParser().parseFromString(str,\"text/xml\");\r\n                windoww.doctojson = (doc: any) => prxml2json.xml2jsonobj(doc, ' ');\r\n                // problemi doctojson or xmi parser: \\n replacemet causa crash per stringa in posizione invalida. \\\" anche per attributi inline che iniiano con \\\\\"\r\n                // filestring = U.multiReplaceAll(filestring, [\"\\t\", \"\\r\", \"\\n\", '&amp;', '&#38;', '&quot;', '&', '\\'', '\"'], [\"\\\\t\", \"\\\\r\", \"\\\\n\", '\\\\&', \"\\\\'\", '\\\\\"', '\\\\&', \"\\\\'\", '\\\\\"']);//,  \"\\\\t\"), \"\\r\", \"\\\\r\"), \"\\n\", \"\\\\n\");\r\n\r\n                const xmlDoc = new DOMParser().parseFromString(filestring,\"text/xml\");\r\n                console.log('importEcore xml:', xmlDoc);\r\n                let jsonstring0 = '';\r\n                jsonobj = prxml2json.xml2jsonobj(xmlDoc, ' ');//doto: non devo wrappare con \\\" i nomi di chiavi o valori ma solo i contenuti\r\n                /*jsonstring = jsonstring0;\r\n                //jsonstring = U.multiReplaceAll(jsonstring0, [\"\\t\", \"\\r\", \"\\n\", '&amp;', '&#38;', '&quot;', '&', '\\'', '\"'], [\"\\\\t\", \"\\\\r\", \"\\\\n\", '\\\\&', \"\\\\'\", '\\\\\"', '\\\\&', \"\\\\'\", '\\\\\"']);//,  \"\\\\t\"), \"\\r\", \"\\\\r\"), \"\\n\", \"\\\\n\");\r\n                *///jsonstring = jsonstring.replaceAll(/(\\{|\\,)\\\\n\\s*/gm, \"\")\r\n                /*if (jsonstring.includes(\"\\n\")) throw new Error(jsonstring0.substring(0, 1000)+\"\\n\\n\\n\\n\" + jsonstring.substring(0, 1000));\r\n                */\r\n                // jsonstring = JSON.stringify(jsonobj);\r\n                if (jsonobj.parsererror) { Log.e(\"failed to parse XML->JSON\", {parseError:jsonobj.parseerror, jsonobj});  return; }\r\n                console.log('importEcore jsonstr input: ', jsonobj);\r\n            }\r\n            else jsonstring = filestring;\r\n            let isMetamodel = filename.indexOf(\".ecore\") === filename.length - \".ecore\".length;\r\n            console.log(\"ismetamodel\", {filename, isMetamodel});\r\n            let end = SaveManager.importEcore(jsonobj || jsonstring || 'null', isMetamodel, filename, true);\r\n        }, extensions, true);\r\n    }\r\n\r\n    public static exportEcore(model: LModel): Json {\r\n        let loopobj = {};\r\n        try { return model.generateEcoreJson(loopobj); }\r\n        catch(e) { Log.exx(\"possible loop in model:\\t\\n\" + (e as Error).message, {loopobj, e}); }\r\n        return {\"error\": true, loopobj};\r\n    }\r\n    public static importEcore(jsonstr: GObject | string | null, isMetamodel: boolean, filename: string | undefined, persist: boolean = true): DModelElement[] {\r\n        return EcoreParser.parse(jsonstr, isMetamodel, filename, persist);\r\n    }\r\n\r\n    static exportLayout_click(toFile: boolean) {\r\n        let lmodel: LModel = (LPointerTargetable.wrap(store.getState().models[0]) as LModel);\r\n        // lmodel.node?.allSubNodes\r\n\r\n    }\r\n    static importLayout_click(fromFile: boolean) {\r\n\r\n    }\r\n}\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
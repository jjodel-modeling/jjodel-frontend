{"ast":null,"code":"var _jsxFileName = \"C:\\\\0Programmi\\\\Dev\\\\projects\\\\frontend\\\\jjodel\\\\src\\\\components\\\\editors\\\\Console.tsx\",\n  _this = this;\nimport { LGraphElement, Log, RuntimeAccessibleClass, transientProperties, U, windoww } from '../../joiner';\nimport React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport './style.scss'; // <-- tenuto per retro-compatibilit√† ma dovrebbe sparire\nimport './editors.scss'; // <-- stile comune a tutte le tab editor (idealmente da tenere leggero)\nimport './console.scss'; // <-- stile di questa tab\nimport ReactDOM from \"react-dom\";\nimport { Empty } from \"./Empty\";\nimport { Tooltip } from \"../forEndUser/Tooltip\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Convert = require('ansi-to-html');\nlet ansiConvert = window.ansiConvert;\nif (!ansiConvert) window.ansiconvert = ansiConvert = new Convert();\nclass ThisState {\n  constructor() {\n    this.expression = '';\n    this.output = null;\n    this.expressionIndex = 0;\n    this.expressionHistory = [''];\n    this.initialState = true;\n    this.time = 0;\n  }\n}\n\n// trasformato in class component cos√¨ puoi usare il this nella console. e non usa accidentalmente window come contesto\n\nlet hiddenkeys = [\"jsxString\", \"pointedBy\", \"clonedCounter\", \"parent\", \"_subMaps\", \"inspect\", \"__random\", '__serialize'];\nfunction fixproxy(output) {\n  var _output;\n  let addDKeys = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  let addLKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  let ret = {\n    output\n  };\n  if (!output) return ret;\n  let proxy;\n  if ((_output = output) === null || _output === void 0 ? void 0 : _output.__isProxy) {\n    proxy = output;\n    output = output.__raw; //Object.fromEntries(Object.getOwnPropertyNames(p).map(k => [k, p[k]]));\n  } else proxy = undefined;\n  console.log('console short in 1', {\n    output,\n    proxy,\n    ret,\n    addLKeys,\n    iff: addLKeys && proxy\n  });\n  switch (typeof output) {\n    case \"function\":\n      {\n        let fdata = U.buildFunctionDocumentation(output);\n        return {\n          output: fdata\n        };\n      }\n    default:\n      return ret;\n    case \"object\":\n      // if (Array.isArray(output)) { ret.output = output; break; /* no need to go inside, it is already done at render phase */ }\n      ret.output = output = {\n        ...output\n      };\n      // if (ret.output.anchors) ret.output.anchors = JSON.stringify(ret.output.anchors);\n      if (addLKeys && proxy) {\n        var _RuntimeAccessibleCla, _RuntimeAccessibleCla2, _output2, _output3, _RuntimeAccessibleCla3, _output4;\n        let Lsingleton = ((_RuntimeAccessibleCla = RuntimeAccessibleClass.get((_output2 = output) === null || _output2 === void 0 ? void 0 : _output2.className)) === null || _RuntimeAccessibleCla === void 0 ? void 0 : (_RuntimeAccessibleCla2 = _RuntimeAccessibleCla.logic) === null || _RuntimeAccessibleCla2 === void 0 ? void 0 : _RuntimeAccessibleCla2.singleton) || {};\n        let comments = {};\n        ret.shortcuts = {\n          ...Lsingleton\n        };\n        console.log('console short in 2', {\n          output,\n          rett: {\n            ...ret,\n            shortt: {\n              ...(ret.shortcuts || {})\n            }\n          },\n          Lsingleton,\n          DClass: RuntimeAccessibleClass.get((_output3 = output) === null || _output3 === void 0 ? void 0 : _output3.className),\n          LClass: (_RuntimeAccessibleCla3 = RuntimeAccessibleClass.get((_output4 = output) === null || _output4 === void 0 ? void 0 : _output4.className)) === null || _RuntimeAccessibleCla3 === void 0 ? void 0 : _RuntimeAccessibleCla3.logic\n        });\n        ret.comments = comments;\n        for (let key in output) {\n          if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\n        }\n        for (let key in Lsingleton) {\n          if (key in output || key.indexOf(\"__info_of__\") === 0) {\n            delete ret.shortcuts[key];\n            continue;\n          } else {\n            if (ret.shortcuts[key] === undefined) ret.shortcuts[key] = '';\n          }\n          if (key.indexOf(\"info\") >= 0 && key.indexOf(\"of\") >= 0) {\n            Log.eDevv('Possible error on __info_of__ misnamed as ' + key + ', if the name was intentional' + ' and not an Info object add an allowal rule here.');\n            continue;\n          }\n          if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\n          if (comments[key]) continue; // if explicitly commented, i will not attempt to generate documentation.\n          let entryvalue = Lsingleton[key];\n          switch (typeof entryvalue) {\n            default:\n            case \"object\":\n              ret.shortcuts[key] = entryvalue;\n              break;\n            case \"function\":\n              ret.shortcuts[key] = U.buildFunctionDocumentation(entryvalue);\n              break;\n          }\n        }\n        console.log('console short in 3', {\n          ret\n        });\n      }\n      if (hiddenkeys) {\n        ret.hiddenkeys = {};\n        for (let key of hiddenkeys) {\n          ret.hiddenkeys[key] = output[key];\n          delete output[key];\n          if (ret.shortcuts) delete ret.shortcuts[key];\n        }\n      }\n      break;\n  }\n\n  //@ts-ignore\n  //ret ={...ret, shortcuts: undefined, comments: undefined, hiddenkeys: undefined};\n\n  return ret;\n}\nclass ConsoleComponent extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.lastNode = void 0;\n    this._context = {};\n    this.outputhtml = null;\n    this.state = new ThisState();\n    this.change = this.change.bind(this);\n    this.change(undefined);\n  }\n  change(evt) {\n    var _this$props$node;\n    if (!this) return; // component being destroyed and remade after code hot update\n    let expression0 = (evt ? evt.target.value : this.state.expression) || '';\n    let expression = expression0.trim();\n    let output;\n    // let context = {...this.props, props: this.props}; // makeEvalContext(this.props as any, {} as any);\n\n    let nid = (_this$props$node = this.props.node) === null || _this$props$node === void 0 ? void 0 : _this$props$node.id;\n    let tn = transientProperties.node[nid];\n    if (nid && tn) {\n      // let component = GraphElementComponent.map[this.props.node.id];\n      this._context = {\n        ...tn.viewScores[tn.mainView.id].evalContext\n      };\n      this._context.fromcomponent = true;\n    } else {\n      this._context = {\n        ...this.props,\n        props: this.props\n      };\n    }\n    try {\n      // if (expression === 'this') expression = 'data'; // it does a mess by taking a L-singleton with all his __info_of__ stuff\n      if (expression === 'this') output = this._context;else output = U.evalInContextAndScope(expression || '<span class=\"console-msg\">undefined</span>', this._context, this._context);\n    } catch (e) {\n      console.error(\"console error\", e);\n      // output = '<span class=\"console-error\">Invalid Syntax!</span> <span class=\"console-error-msg\">' + e.toString() + '<span>' ; }\n      output = '<span class=\"console-error-msg\"><i class=\"bi bi-exclamation-square-fill\"></i><span>' + e.toString() + '</span></span>';\n    }\n    this.setState({\n      expression: expression0,\n      output\n    });\n  }\n\n  // textarea: HTMLTextAreaElement | null = null;\n  getClickableEntry(jsxComments, strcomments, expression, k, arr) {\n    let isReactNode = !!jsxComments[k];\n    let infoof_tooltip;\n    if (isReactNode) {\n      infoof_tooltip = \"<span id='console_output_comment_key_\" + k + \"' class='tooltip-msg'/>\"; //jsxComments[k];\n    } else {\n      infoof_tooltip = strcomments[k].txt;\n    }\n    if (k === 'father') console.log('jsx comment', {\n      k,\n      infoof_tooltip,\n      jsxComments: {\n        ...jsxComments\n      }\n    });\n    if (k === 'isM1') console.log('jsx comment', {\n      k,\n      infoof_tooltip,\n      jsxComments: {\n        ...jsxComments\n      }\n    });\n    return /*#__PURE__*/_jsxDEV(\"li\", {\n      onClick: () => {\n        let isnum = !isNaN(+k);\n        let isregular = isnum ? true : /\\w/.test(k);\n        let append;\n        if (isnum) append = '[' + k + ']';else if (isregular) append = '.' + k;else append = '[' + JSON.stringify(k) + ']';\n        this.setState({\n          expression: expression ? expression + append : k\n        } /*, ()=> { this.change(); }*/);\n      },\n      children: [k, arr && arr[k] || undefined, infoof_tooltip]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 16\n    }, this);\n  }\n  setState(s, callback) {\n    if (s) {\n      if (s.initialState) {\n        delete s.initialState;\n        return super.setState(s);\n      }\n      let s0 = {\n        ...s\n      };\n      let olds = this.state;\n      if (s0.expressionIndex !== undefined && s0.expressionIndex !== olds.expressionIndex) s.expression = olds.expressionHistory[s0.expressionIndex];\n      if (s0.expressionHistory && s0.expressionHistory !== olds.expressionHistory) {\n        let len = s0.expressionHistory.length;\n        if (len > 10) s.expressionHistory = s0.expressionHistory.slice(len - 10, len);\n      }\n      if (s0.expression && s0.expression !== olds.expression) {\n        var _s$expressionIndex;\n        let time = new Date().getTime();\n        let oldtime = olds.time;\n        Log.exDev(s0.expressionIndex !== undefined, 'cannot set both index and expression together');\n        let i = (_s$expressionIndex = s.expressionIndex) !== null && _s$expressionIndex !== void 0 ? _s$expressionIndex : olds.expressionIndex;\n        let slice;\n        if (time - oldtime < 1000) {\n          slice = olds.expressionHistory.slice(0, i);\n        } else {\n          slice = olds.expressionHistory.slice(0, i + 1);\n          s.expressionIndex = i + 1;\n        }\n        s.time = time;\n        s.expressionHistory = [...slice, s0.expression];\n        console.log('setstate', {\n          olds: {\n            ...olds\n          },\n          s,\n          slice,\n          i,\n          s0\n        });\n      }\n      if (s.expression !== olds.expression && !('output' in s)) {\n        let call0 = callback;\n        callback = () => {\n          call0 === null || call0 === void 0 ? void 0 : call0();\n          this.change();\n        };\n      }\n    }\n    super.setState(s, callback);\n  }\n  render() {\n    var _this$state$output, _this$props$node2, _this$props$node3;\n    /*const [expression, setExpression] = useStateIfMounted('data');\r\n    const [output, setOutput] = useStateIfMounted('');*/\n\n    if (!this.props.node) return /*#__PURE__*/_jsxDEV(Empty, {\n      msg: \"Select a node.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 38\n    }, this);\n    let postprocess = true;\n    let expression = this.state.expression.trim();\n    if (expression === 'this') expression = 'data';\n    const data = this.props.data;\n    if (this.lastNode !== this.props.node.id) this.change(); // force reevaluation if selected node changed\n    this.lastNode = this.props.node.id;\n    let outstr;\n    // try { outstr = U.circularStringify(this.state.output, (key, value)=> { return value.__isProxy ? value.name : value; }, \"\\t\", 1) }\n    // (window as any).inspect = util.inspect;\n    // (window as any).tmpp = this.state.output;\n    let ashtml;\n    let output = this.state.output;\n    let shortcuts = undefined;\n    let comments = undefined;\n    let hidden = undefined;\n    let jsxComments = {};\n    let shortcutsjsx = undefined;\n    try {\n      var _output5;\n      if (Array.isArray(output)) {\n        comments = {\n          \"separator\": '<span>Similar to <a href={\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join\"}>Array.join(separator)</a>' + ', but supports array of JSX nodes and JSX as separator argument.</span>'\n        };\n        shortcuts = {\n          \"separator\": \"\"\n        };\n        output = output.map(o => fixproxy(o).output);\n      } else {\n        console.log('console short pre', {\n          output\n        });\n        let ret = fixproxy(output);\n        output = ret.output;\n        comments = ret.comments;\n        shortcuts = ret.shortcuts;\n        console.log('console short', {\n          shortcuts,\n          ret,\n          output\n        });\n        hidden = ret.hiddenkeys;\n      }\n      // todo: as i fix the displaying of a LViewElement without replacing it with __raw,\n      //  i will fix window, component and props displaying too i think they crash for props.data, props.view...\n      if ((_output5 = output) === null || _output5 === void 0 ? void 0 : _output5._reactInternals) {\n        output = {\n          \"React.Component\": {\n            props: \"...navigate to expand...\",\n            state: \"\",\n            _isMounted: output._isMounted\n          }\n        };\n      }\n      outstr = '<h4>Result</h4><section class=\"group result-container\"><div class=\"output-row\" tabindex=\"984\">' + U.objectInspect(output) + \"<span>\";\n      let commentsPopup = \"\";\n      if (shortcuts || comments) {\n        // if(!shortcuts) shortcuts = {};\n        if (!comments) comments = {};\n        for (let commentKey in comments) {\n          var _commentVal, _commentVal2, _commentVal3, _commentVal3$type;\n          let commentVal = comments[commentKey];\n          let txt = (_commentVal = commentVal) === null || _commentVal === void 0 ? void 0 : _commentVal.txt;\n          if (txt && typeof txt !== \"string\") {\n            // only for infoof that have txt = reactNode\n            // try to inject jsx\n            jsxComments[commentKey] = txt;\n            txt = \"<span id='console_output_comment_\" + commentKey + \"'  class='tooltip-msg'/>\";\n            // fallback read text, that should go deep iteration, but 1 level deep should be enough.\n            // let arr: any[] = (Array.isArray(txt?.props?.children) ? txt.props.children : (txt.props.children ? [txt.props.children] : []));\n            // txt = arr.map(e => typeof e === \"string\" ? e : e?.props?.children + '' || '').join(\"\");\n          }\n          if ((_commentVal2 = commentVal) === null || _commentVal2 === void 0 ? void 0 : _commentVal2.type) commentVal = \"\\t\\t<span class='console-msg'>\" + (((_commentVal3 = commentVal) === null || _commentVal3 === void 0 ? void 0 : (_commentVal3$type = _commentVal3.type) === null || _commentVal3$type === void 0 ? void 0 : _commentVal3$type.cname) || commentVal.type) + \"</span>\"; // + \" ~ \" + txt;\n          // warning: unicode char but should not make a problem. êÄπ\n          commentVal += '<div class=\"output-comment my-tooltip\">' + txt + '</div></div><div class=\"output-row\" tabindex=\"984\">';\n          if (postprocess) {\n            let commentKeyEscaped = U.multiReplaceAll(commentKey, [\"$\", \"-\"], [\"\\\\$\", \"\\\\-\"]); // _ should be safe, .-,?^ not happening?\n\n            let regexp = new RegExp(\"^({?\\\\s*\" + commentKeyEscaped + \":.*)$\", \"gm\");\n            let regexpCloseTags = new RegExp(\"(\\\\<span style\\\\=\\\"color\\\\:\\\\#)\", \"gm\");\n            outstr = U.replaceAll(outstr, \"$\", \"¬£\");\n            outstr = outstr.replace(regexp, \"$1\" + commentVal);\n            outstr = outstr.replace(regexpCloseTags, \"</span>$1\");\n            outstr = U.replaceAll(outstr, \"¬£\", \"$\");\n          }\n        }\n\n        /*if (shortcuts) outstr += \"</div></section><br><br>\" +\r\n            \"<h4>Shortcuts</h4><section class='group shortcuts-container'><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + U.objectInspect(shortcuts)+\"</section>\";\r\n        */\n\n        // if (hidden) outstr +=\"</div><br><br><h4>Other less useful properties</h4><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + format(hidden);\n        // warning: unicode char but should not make a problem.\n        // outstr = U.replaceAll( outstr, 'êÄπ,\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span style=\"color:#000\">');\n        windoww.outstr = outstr.substring(0, 500);\n        windoww.outstrr = outstr;\n        // [length]: <span style=\"color:#A50\">1<span style=\"color:#000\"> ]\n        if (postprocess) {\n          // let closetagsafely = '</span>';\n          let closetagsafely = '</span></span></span></span></span></span></span></span></span></span>';\n          outstr = U.replaceAll(outstr, '<span style=\"color:#000\">,\\n', closetagsafely + '\\n</div>' + '<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\n          outstr = U.replaceAll(outstr, '<span style=\"color:#000\"> ],\\n', ']</span>\\n</div>' + '<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\n          outstr = U.replaceAll(outstr, ': {},\\n', ': {}</span>\\n</div>' + '<div class=\"output-row\" tabindex=\"984\">');\n          // let regexpFixArray = /,?\\s\\[length\\]:\\s<span style=\"color:#A50\">\\d<span style=\"color:#000\">\\s/gm;\n          windoww.outp = outstr;\n          // let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+]/gm;\n          let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+(<span style=\"color:#000\">\\s){0,1}]/gm;\n          outstr = outstr.replaceAll(regexpFixArray, \"&nbsp;]</span>\");\n          outstr = U.replaceAll(outstr, ': [&nbsp;]', ': []');\n        }\n        let postprocessold = false;\n        if (postprocessold) {\n          outstr = U.replaceAll(outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n', '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\n          /*outstr = U.replaceAll( outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n',\r\n              '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');*/\n\n          outstr = U.replaceAll(outstr, '],\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\n          outstr = U.replaceAll(outstr, '},\\n', '},</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\n        }\n      }\n      ashtml = true;\n    } catch (e) {\n      console.error(e);\n      throw e;\n      outstr = \"[circular object]: \" + e.toString();\n      ashtml = false;\n    }\n    let contextkeysarr;\n    let contextkeys = '';\n    if (this.state.expression.trim() === \"this\") contextkeys = \"Warning: \\\"this\\\" in the console is aliased to data instead of the whole context of a GraphElement component.\";\n    let objraw = ((_this$state$output = this.state.output) === null || _this$state$output === void 0 ? void 0 : _this$state$output.__raw) || (typeof this.state.output === \"object\" ? this.state.output : \"[primitiveValue]\") || {};\n    if (this.state.expression.trim() === \"\") contextkeysarr = [\"data\", \"node\", \"view\", \"component\"];else if (typeof objraw === \"string\") {\n      contextkeysarr = Object.keys(String.prototype);\n    } else contextkeysarr = (Array.isArray(objraw) ? [...Object.keys(objraw).filter(k => k <= 10).map(k => k === 10 ? '...' : '' + k), ...Object.keys(Array.prototype)] : Object.getOwnPropertyNames(objraw)) || [];\n    let injectCommentJSX = () => {\n      try {\n        for (let key in jsxComments) {\n          if (hiddenkeys.includes(key)) continue;\n          let commentNode = document.getElementById(\"console_output_comment_\" + key);\n          Log.eDev(!commentNode, \"failed to find comment placeholder\", {\n            key,\n            v: jsxComments[key],\n            jsxComments\n          });\n          if (commentNode) ReactDOM.render(jsxComments[key], commentNode);\n          // for shortcut or context keys, this can fail without warning as some shortcuts are missing\n          commentNode = document.getElementById(\"console_output_comment_key_\" + key);\n          if (commentNode) ReactDOM.render(jsxComments[key], commentNode);\n        }\n      } catch (e) {\n        console.error(\"failed to inject console output comment:\", e);\n      }\n    };\n    setTimeout(injectCommentJSX, 1);\n    this.setNativeConsoleVariables();\n    windoww.output = output;\n    const undo = () => {\n      let expressionIndex = Math.max(0, this.state.expressionIndex - 1);\n      if (expressionIndex === this.state.expressionIndex) return;\n      this.setState({\n        expressionIndex\n      });\n    };\n    const redo = () => {\n      const expressionHistory = this.state.expressionHistory;\n      let expressionIndex = Math.min(expressionHistory.length - 1, this.state.expressionIndex + 1);\n      if (expressionIndex === this.state.expressionIndex) return;\n      this.setState({\n        expressionIndex\n      });\n    };\n    let canredo = this.state.expressionIndex < this.state.expressionHistory.length - 1;\n    let canundo = this.state.expressionIndex > 0;\n    let advanced = this.props.advanced;\n    contextkeys = /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: contextkeysarr.sort().map(k => this.getClickableEntry(jsxComments, comments || {}, expression, k))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 23\n    }, this);\n    if (shortcuts) {\n      shortcutsjsx = /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: Object.keys(shortcuts).sort().map(k => this.getClickableEntry(jsxComments, comments || {}, expression, k, shortcuts))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 28\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: 'w-100 h-100 p-2 console',\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"On \", ((data === null || data === void 0 ? void 0 : data.name) || \"model-less node (\" + ((_this$props$node2 = this.props.node) === null || _this$props$node2 === void 0 ? void 0 : _this$props$node2.className) + \")\") + \" - \" + ((_this$props$node3 = this.props.node) === null || _this$props$node3 === void 0 ? void 0 : _this$props$node3.className)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"console-terminal p-0 mb-2 w-100\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"commands\",\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            onClick: e => {\n              this.setState({\n                expression: '',\n                expressionHistory: [''],\n                expressionIndex: 0\n              });\n            },\n            title: 'Empty console',\n            className: \"bi bi-slash-circle\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            onClick: e => {\n              var _this$outputhtml;\n              if (!this.state.expression.trim()) {\n                return Tooltip.show('Nothing to copy', undefined, undefined, 2);\n              }\n              let s = ((_this$outputhtml = this.outputhtml) === null || _this$outputhtml === void 0 ? void 0 : _this$outputhtml.innerText) || '';\n              s = s.substring('Result'.length).trim();\n              U.clipboardCopy(s, () => Tooltip.show('Content copied to clipboard', undefined, undefined, 2));\n            },\n            title: 'Copy in the clipboard',\n            className: \"bi bi-clipboard-plus\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            onClick: redo,\n            title: 'redo',\n            className: \"redo bi bi-arrow-right-square\" + (canredo ? '' : \" disabled\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            onClick: undo,\n            title: 'undo',\n            className: \"undo bi bi-arrow-left-square\" + (canundo ? '' : \" disabled\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 421,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          id: 'console',\n          spellCheck: false,\n          className: 'p-0 input w-100',\n          onChange: this.change,\n          value: this.state.expression\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 13\n      }, this), advanced && this.state.expressionHistory.length > 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\"Advanced query history (index = \", this.state.expressionIndex, \")\", this.state.expressionHistory.slice(-5).map((s, i) => i === 0 ? null : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              border: '1px solid ' + (i === this.state.expressionIndex ? 'red' : 'gray'),\n              marginTop: '5px',\n              height: '30px'\n            },\n            children: i + ') ' + s\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 21\n          }, this)\n        }, void 0, false))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 427,\n        columnNumber: 67\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {\n        className: 'mt-1 mb-1'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 13\n      }, this), this.state.expression && ashtml && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"console-output-container console-msg\",\n        ref: e => this.outputhtml = e,\n        dangerouslySetInnerHTML: ashtml ? {\n          __html: outstr\n        } : undefined\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 49\n      }, this), this.state.expression && !ashtml && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"console-output-container console-msg\",\n        ref: e => this.outputhtml = e,\n        style: {\n          whiteSpace: \"pre\"\n        },\n        children: outstr\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 50\n      }, this), contextkeysarr.length && /*#__PURE__*/_jsxDEV(\"section\", {\n        className: 'group context-keys-list',\n        style: {\n          whiteSpace: \"pre\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"context-keys\",\n          children: \"Context keys\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 21\n        }, this), contextkeys]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 39\n      }, this), shortcutsjsx && /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"group shortcuts-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"context-keys pt-0\",\n          children: \"Shortcuts\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 452,\n          columnNumber: 17\n        }, this), shortcutsjsx]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 30\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 16\n    }, this);\n  }\n  setNativeConsoleVariables() {\n    var _context$data, _context$data2;\n    // just fordebugging\n    let context = this._context;\n    windoww.context = context;\n    windoww.data = context.data;\n    windoww.node = context.node;\n    windoww.edge = context.edge;\n    windoww.output = this.state.output;\n    if ((_context$data = context.data) === null || _context$data === void 0 ? void 0 : _context$data.model) windoww.model = (_context$data2 = context.data) === null || _context$data2 === void 0 ? void 0 : _context$data2.model;\n  }\n}\nConsoleComponent.cname = \"ConsoleComponent\";\nfunction mapStateToProps(state, ownProps) {\n  var _state$_lastSelected;\n  const ret = {};\n  const nodeid = (_state$_lastSelected = state._lastSelected) === null || _state$_lastSelected === void 0 ? void 0 : _state$_lastSelected.node;\n  const node = nodeid ? LGraphElement.fromPointer(nodeid) : null;\n  ret.node = node;\n  ret.data = (node === null || node === void 0 ? void 0 : node.model) ? node.model : null;\n  ret.view = (node === null || node === void 0 ? void 0 : node.view) ? node.view : null;\n  ret.advanced = state.advanced;\n  return ret;\n}\nfunction mapDispatchToProps(dispatch) {\n  const ret = {};\n  return ret;\n}\nexport const ConsoleConnected = connect(mapStateToProps, mapDispatchToProps)(ConsoleComponent);\nexport const Console = function (props) {\n  let children = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return /*#__PURE__*/_jsxDEV(ConsoleConnected, {\n    ...props,\n    children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 503,\n    columnNumber: 12\n  }, _this);\n};\n_c = Console;\nexport default Console;\nvar _c;\n$RefreshReg$(_c, \"Console\");","map":{"version":3,"names":["LGraphElement","Log","RuntimeAccessibleClass","transientProperties","U","windoww","React","PureComponent","connect","ReactDOM","Empty","Tooltip","jsxDEV","_jsxDEV","Fragment","_Fragment","Convert","require","ansiConvert","window","ansiconvert","ThisState","constructor","expression","output","expressionIndex","expressionHistory","initialState","time","hiddenkeys","fixproxy","_output","addDKeys","arguments","length","undefined","addLKeys","ret","proxy","__isProxy","__raw","console","log","iff","fdata","buildFunctionDocumentation","_RuntimeAccessibleCla","_RuntimeAccessibleCla2","_output2","_output3","_RuntimeAccessibleCla3","_output4","Lsingleton","get","className","logic","singleton","comments","shortcuts","rett","shortt","DClass","LClass","key","indexOf","eDevv","entryvalue","ConsoleComponent","props","lastNode","_context","outputhtml","state","change","bind","evt","_this$props$node","expression0","target","value","trim","nid","node","id","tn","viewScores","mainView","evalContext","fromcomponent","evalInContextAndScope","e","error","toString","setState","getClickableEntry","jsxComments","strcomments","k","arr","isReactNode","infoof_tooltip","txt","onClick","isnum","isNaN","isregular","test","append","JSON","stringify","children","fileName","_jsxFileName","lineNumber","columnNumber","s","callback","s0","olds","len","slice","_s$expressionIndex","Date","getTime","oldtime","exDev","i","call0","render","_this$state$output","_this$props$node2","_this$props$node3","msg","postprocess","data","outstr","ashtml","hidden","shortcutsjsx","_output5","Array","isArray","map","o","_reactInternals","_isMounted","objectInspect","commentsPopup","commentKey","_commentVal","_commentVal2","_commentVal3","_commentVal3$type","commentVal","type","cname","commentKeyEscaped","multiReplaceAll","regexp","RegExp","regexpCloseTags","replaceAll","replace","substring","outstrr","closetagsafely","outp","regexpFixArray","postprocessold","contextkeysarr","contextkeys","objraw","Object","keys","String","prototype","filter","getOwnPropertyNames","injectCommentJSX","includes","commentNode","document","getElementById","eDev","v","setTimeout","setNativeConsoleVariables","undo","Math","max","redo","min","canredo","canundo","advanced","sort","name","title","_this$outputhtml","show","innerText","clipboardCopy","spellCheck","onChange","style","border","marginTop","height","ref","dangerouslySetInnerHTML","__html","whiteSpace","_context$data","_context$data2","context","edge","model","mapStateToProps","ownProps","_state$_lastSelected","nodeid","_lastSelected","fromPointer","view","mapDispatchToProps","dispatch","ConsoleConnected","Console","_this","_c","$RefreshReg$"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/src/components/editors/Console.tsx"],"sourcesContent":["import {\r\n    DEdge,\r\n    DGraphElement,\r\n    Dictionary,\r\n    DState,\r\n    GObject,\r\n    LGraphElement,\r\n    LModelElement,\r\n    Log,\r\n    LPointerTargetable,\r\n    LViewElement,\r\n    Pointer,\r\n    RuntimeAccessibleClass,\r\n    transientProperties,\r\n    U,\r\n    windoww\r\n} from '../../joiner';\r\nimport {FakeStateProps} from '../../joiner/types';\r\nimport React, {Component, Dispatch, PureComponent, ReactElement, ReactNode} from 'react';\r\nimport {connect} from 'react-redux';\r\n\r\nimport './style.scss'; // <-- tenuto per retro-compatibilit√† ma dovrebbe sparire\r\nimport './editors.scss'; // <-- stile comune a tutte le tab editor (idealmente da tenere leggero)\r\nimport './console.scss'; // <-- stile di questa tab\r\nimport ReactDOM from \"react-dom\";\r\nimport {Empty} from \"./Empty\";\r\nimport {Tooltip} from \"../forEndUser/Tooltip\";\r\n\r\nconst Convert = require('ansi-to-html');\r\n\r\nlet ansiConvert = (window as any).ansiConvert;\r\nif (!ansiConvert) (window as any).ansiconvert = ansiConvert = new Convert();\r\n\r\nclass ThisState{\r\n    expression: string = '';\r\n    output: any = null;\r\n    expressionIndex: number = 0;\r\n    expressionHistory: string[] = [''];\r\n    initialState: boolean = true;\r\n    time: number = 0;\r\n}\r\n\r\n// trasformato in class component cos√¨ puoi usare il this nella console. e non usa accidentalmente window come contesto\r\n\r\nlet hiddenkeys = [\"jsxString\", \"pointedBy\", \"clonedCounter\", \"parent\", \"_subMaps\", \"inspect\", \"__random\", '__serialize'];\r\nfunction fixproxy(output: any/*but not array*/, addDKeys: boolean = true, addLKeys: boolean = true):\r\n    { output: any, shortcuts?: GObject<'L singleton'>, comments?: Dictionary<string, string | {type:string, txt:string}>, hiddenkeys?: GObject} {\r\n\r\n    let ret: ReturnType<typeof fixproxy> = {output};\r\n    if (!output) return ret;\r\n\r\n    let proxy: LPointerTargetable | undefined;\r\n    if (output?.__isProxy) {\r\n        proxy = output;\r\n        output = output.__raw; //Object.fromEntries(Object.getOwnPropertyNames(p).map(k => [k, p[k]]));\r\n    } else proxy = undefined;\r\n\r\n    console.log('console short in 1', {output, proxy, ret, addLKeys, iff:addLKeys && proxy});\r\n\r\n    switch (typeof output) {\r\n        case \"function\": {\r\n            let fdata =  U.buildFunctionDocumentation(output);\r\n            return {output: fdata};\r\n        }\r\n        default: return ret;\r\n        case \"object\":\r\n            // if (Array.isArray(output)) { ret.output = output; break; /* no need to go inside, it is already done at render phase */ }\r\n            ret.output = output = {...output};\r\n            // if (ret.output.anchors) ret.output.anchors = JSON.stringify(ret.output.anchors);\r\n            if (addLKeys && proxy) {\r\n                let Lsingleton: GObject<'L singleton'> = (RuntimeAccessibleClass.get(output?.className)?.logic?.singleton) || {};\r\n                let comments: Dictionary<string, string | {type:string, txt:string}> = {};\r\n                ret.shortcuts = {...Lsingleton};\r\n                console.log('console short in 2', {output, rett:{...ret, shortt:{...(ret.shortcuts||{})}}, Lsingleton, DClass:RuntimeAccessibleClass.get(output?.className), LClass:RuntimeAccessibleClass.get(output?.className)?.logic});\r\n                ret.comments = comments;\r\n                for (let key in output) {\r\n                    if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\r\n                }\r\n                for (let key in Lsingleton) {\r\n                    if ((key in output) || (key.indexOf(\"__info_of__\") === 0)) {\r\n                        delete ret.shortcuts[key];\r\n                        continue;\r\n                    } else { if (ret.shortcuts[key] === undefined) ret.shortcuts[key] = ''; }\r\n                    if (key.indexOf(\"info\") >=0 && key.indexOf(\"of\") >=0){\r\n                        Log.eDevv('Possible error on __info_of__ misnamed as '+key+', if the name was intentional' +\r\n                            ' and not an Info object add an allowal rule here.');\r\n                        continue;\r\n                    }\r\n                    if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\r\n                    if (comments[key]) continue; // if explicitly commented, i will not attempt to generate documentation.\r\n                    let entryvalue = Lsingleton[key];\r\n                    switch (typeof entryvalue) {\r\n                        default:\r\n                        case \"object\":\r\n                            ret.shortcuts[key] = entryvalue;\r\n                            break;\r\n                        case \"function\":\r\n                            ret.shortcuts[key] = U.buildFunctionDocumentation(entryvalue);\r\n                            break;\r\n                    }\r\n                }\r\n                console.log('console short in 3', {ret});\r\n\r\n            }\r\n            if (hiddenkeys) {\r\n                ret.hiddenkeys = {};\r\n                for (let key of hiddenkeys) {\r\n                    ret.hiddenkeys[key] = output[key];\r\n                    delete output[key];\r\n                    if (ret.shortcuts) delete ret.shortcuts[key];\r\n                }\r\n            }\r\n            break;\r\n    }\r\n\r\n    //@ts-ignore\r\n    //ret ={...ret, shortcuts: undefined, comments: undefined, hiddenkeys: undefined};\r\n\r\n    return ret;\r\n}\r\n\r\n\r\nclass ConsoleComponent extends PureComponent<AllProps, ThisState>{\r\n    public static cname: string = \"ConsoleComponent\";\r\n    lastNode?: Pointer<DGraphElement>;\r\n    constructor(props: AllProps) {\r\n        super(props);\r\n        this.state = new ThisState();\r\n        this.change = this.change.bind(this);\r\n        this.change(undefined);\r\n    }\r\n    private _context: GObject = {};\r\n    change(evt?: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        if (!this) return; // component being destroyed and remade after code hot update\r\n        let expression0: string = (evt ? evt.target.value : this.state.expression) || '';\r\n        let expression: string = expression0.trim();\r\n        let output;\r\n        // let context = {...this.props, props: this.props}; // makeEvalContext(this.props as any, {} as any);\r\n\r\n        let nid = this.props.node?.id;\r\n        let tn = transientProperties.node[nid as string];\r\n        if (nid && tn) {\r\n            // let component = GraphElementComponent.map[this.props.node.id];\r\n            this._context = {...tn.viewScores[tn.mainView.id].evalContext};\r\n            this._context.fromcomponent = true;\r\n        }\r\n        else {\r\n            this._context = {...this.props, props: this.props};\r\n        }\r\n        try {\r\n            // if (expression === 'this') expression = 'data'; // it does a mess by taking a L-singleton with all his __info_of__ stuff\r\n            if (expression === 'this') output = this._context;\r\n            else output = U.evalInContextAndScope(expression || '<span class=\"console-msg\">undefined</span>', this._context, this._context);\r\n        }\r\n        catch (e: any) {\r\n            console.error(\"console error\", e);\r\n            // output = '<span class=\"console-error\">Invalid Syntax!</span> <span class=\"console-error-msg\">' + e.toString() + '<span>' ; }\r\n            output = '<span class=\"console-error-msg\"><i class=\"bi bi-exclamation-square-fill\"></i><span>' + e.toString() + '</span></span>' ; }\r\n        this.setState({expression:expression0, output });\r\n    }\r\n\r\n    // textarea: HTMLTextAreaElement | null = null;\r\n    getClickableEntry(jsxComments: Dictionary<string, ReactNode>, strcomments: Dictionary<string, Info>, expression: string, k: string, arr?: any): JSX.Element{\r\n        let isReactNode = !!jsxComments[k];\r\n        let infoof_tooltip: string | ReactNode;\r\n        if (isReactNode){\r\n            infoof_tooltip = \"<span id='console_output_comment_key_\" + k + \"' class='tooltip-msg'/>\";//jsxComments[k];\r\n        } else {\r\n            infoof_tooltip = strcomments[k].txt;\r\n        }\r\n        if (k === 'father') console.log('jsx comment', {k, infoof_tooltip, jsxComments:{...jsxComments}});\r\n        if (k === 'isM1') console.log('jsx comment', {k, infoof_tooltip, jsxComments:{...jsxComments}});\r\n        return <li onClick={()=> {\r\n            let isnum = !isNaN(+k);\r\n            let isregular: boolean = isnum ? true : /\\w/.test(k);\r\n            let append: string;\r\n            if (isnum) append = '['+k+']';\r\n            else if (isregular) append = '.'+k;\r\n            else append = '['+JSON.stringify(k)+']';\r\n            this.setState({expression: (expression ? expression + append : k)}/*, ()=> { this.change(); }*/);\r\n        }}>{k}{arr && arr[k] || undefined}{infoof_tooltip}</li>;\r\n    }\r\n\r\n    outputhtml: HTMLElement | null = null;\r\n    setState(s: GObject<Partial<ThisState>> | null, callback?: (...a:any) => any): void{\r\n        if (s){\r\n            if (s.initialState) {\r\n                delete s.initialState;\r\n                return super.setState(s as any);\r\n            }\r\n            let s0: GObject<ThisState> = {...s} as any;\r\n            let olds = this.state;\r\n            if (s0.expressionIndex !== undefined && s0.expressionIndex !== olds.expressionIndex) s.expression = olds.expressionHistory[s0.expressionIndex];\r\n            if (s0.expressionHistory && s0.expressionHistory !== olds.expressionHistory){\r\n                let len = s0.expressionHistory.length;\r\n                if (len > 10) s.expressionHistory = s0.expressionHistory.slice(len - 10, len);\r\n            }\r\n            if (s0.expression && s0.expression !== olds.expression) {\r\n                let time = new Date().getTime();\r\n                let oldtime = olds.time;\r\n                Log.exDev(s0.expressionIndex !== undefined, 'cannot set both index and expression together');\r\n                let i = s.expressionIndex ?? olds.expressionIndex;\r\n                let slice: string[];\r\n                if (time - oldtime < 1000) {\r\n                    slice = olds.expressionHistory.slice(0, i);\r\n                }\r\n                else {\r\n                    slice = olds.expressionHistory.slice(0, i+1);\r\n                    s.expressionIndex = i + 1;\r\n                }\r\n                s.time = time;\r\n                s.expressionHistory = [...slice, s0.expression];\r\n                console.log('setstate', {olds: {...olds}, s, slice, i, s0});\r\n            }\r\n            if (s.expression !== olds.expression && !('output' in s)) {\r\n                let call0 = callback;\r\n                callback = () => { call0?.(); this.change(); }\r\n            }\r\n        }\r\n        super.setState(s as any, callback);\r\n    }\r\n    render(){\r\n        /*const [expression, setExpression] = useStateIfMounted('data');\r\n        const [output, setOutput] = useStateIfMounted('');*/\r\n\r\n        if (!this.props.node) return <Empty msg={\"Select a node.\"} />;\r\n        let postprocess: boolean = true;\r\n        let expression = this.state.expression.trim();\r\n        if (expression === 'this') expression = 'data';\r\n        const data = this.props.data;\r\n        if (this.lastNode !== this.props.node.id) this.change(); // force reevaluation if selected node changed\r\n        this.lastNode = this.props.node.id;\r\n\r\n        let outstr;\r\n        // try { outstr = U.circularStringify(this.state.output, (key, value)=> { return value.__isProxy ? value.name : value; }, \"\\t\", 1) }\r\n        // (window as any).inspect = util.inspect;\r\n        // (window as any).tmpp = this.state.output;\r\n        let ashtml: boolean\r\n        let output: any = this.state.output;\r\n        let shortcuts: GObject<'L singleton'> | undefined = undefined;\r\n        let comments: Dictionary<string, string | {type:string, txt:string}> | undefined = undefined;\r\n        let hidden: Dictionary<string, string> | undefined = undefined;\r\n        let jsxComments: Dictionary<string, JSX.Element[]> = {};\r\n        let shortcutsjsx: ReactNode = undefined;\r\n        try {\r\n            if (Array.isArray(output)){\r\n                comments = {\"separator\": '<span>Similar to <a href={\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join\"}>Array.join(separator)</a>' +\r\n                        ', but supports array of JSX nodes and JSX as separator argument.</span>'};\r\n                shortcuts = {\"separator\": \"\"};\r\n                output = output.map(o => fixproxy(o).output);\r\n            }\r\n            else {\r\n                console.log('console short pre', {output});\r\n                let ret = fixproxy(output);\r\n                output = ret.output;\r\n                comments = ret.comments;\r\n                shortcuts = ret.shortcuts;\r\n                console.log('console short', {shortcuts, ret, output});\r\n                hidden = ret.hiddenkeys;\r\n            }\r\n            // todo: as i fix the displaying of a LViewElement without replacing it with __raw,\r\n            //  i will fix window, component and props displaying too i think they crash for props.data, props.view...\r\n            if (output?._reactInternals) {\r\n                output = {\"React.Component\": {props:\"...navigate to expand...\", state:\"\", _isMounted:output._isMounted}}\r\n            }\r\n            outstr = '<h4>Result</h4><section class=\"group result-container\"><div class=\"output-row\" tabindex=\"984\">' + U.objectInspect(output)+\"<span>\";\r\n            let commentsPopup = \"\";\r\n            if (shortcuts || comments){\r\n                // if(!shortcuts) shortcuts = {};\r\n                if (!comments) comments = {};\r\n                for (let commentKey in comments){\r\n                    let commentVal: any = comments[commentKey];\r\n                    let txt = commentVal?.txt;\r\n                    if (txt && typeof txt !== \"string\") {// only for infoof that have txt = reactNode\r\n                        // try to inject jsx\r\n                        jsxComments[commentKey] = txt;\r\n                        txt = \"<span id='console_output_comment_\" + commentKey + \"'  class='tooltip-msg'/>\";\r\n                        // fallback read text, that should go deep iteration, but 1 level deep should be enough.\r\n                        // let arr: any[] = (Array.isArray(txt?.props?.children) ? txt.props.children : (txt.props.children ? [txt.props.children] : []));\r\n                        // txt = arr.map(e => typeof e === \"string\" ? e : e?.props?.children + '' || '').join(\"\");\r\n                    }\r\n                    if (commentVal?.type) commentVal = \"\\t\\t<span class='console-msg'>\" + (commentVal?.type?.cname || commentVal.type)+\"</span>\"; // + \" ~ \" + txt;\r\n                    // warning: unicode char but should not make a problem. êÄπ\r\n                    commentVal += '<div class=\"output-comment my-tooltip\">' + txt + '</div></div><div class=\"output-row\" tabindex=\"984\">'\r\n\r\n                    if (postprocess){\r\n                        let commentKeyEscaped = U.multiReplaceAll(commentKey, [\"$\", \"-\"], [\"\\\\$\", \"\\\\-\"]); // _ should be safe, .-,?^ not happening?\r\n\r\n                        let regexp = new RegExp(\"^({?\\\\s*\" +commentKeyEscaped+\":.*)$\", \"gm\");\r\n                        let regexpCloseTags = new RegExp(\"(\\\\<span style\\\\=\\\"color\\\\:\\\\#)\", \"gm\");\r\n                        outstr = U.replaceAll(outstr, \"$\", \"¬£\");\r\n                        outstr = outstr.replace(regexp, \"$1\" + commentVal);\r\n                        outstr = outstr.replace(regexpCloseTags,  \"</span>$1\");\r\n                        outstr = U.replaceAll(outstr, \"¬£\", \"$\");\r\n                    }\r\n                }\r\n\r\n\r\n                /*if (shortcuts) outstr += \"</div></section><br><br>\" +\r\n                    \"<h4>Shortcuts</h4><section class='group shortcuts-container'><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + U.objectInspect(shortcuts)+\"</section>\";\r\n                */\r\n\r\n                // if (hidden) outstr +=\"</div><br><br><h4>Other less useful properties</h4><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + format(hidden);\r\n                // warning: unicode char but should not make a problem.\r\n                // outstr = U.replaceAll( outstr, 'êÄπ,\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span style=\"color:#000\">');\r\n                windoww.outstr = outstr.substring(0, 500);\r\n                windoww.outstrr = outstr;\r\n                // [length]: <span style=\"color:#A50\">1<span style=\"color:#000\"> ]\r\n                if (postprocess){\r\n                    // let closetagsafely = '</span>';\r\n                    let closetagsafely = '</span></span></span></span></span></span></span></span></span></span>';\r\n\r\n                    outstr = U.replaceAll( outstr, '<span style=\"color:#000\">,\\n',\r\n                        closetagsafely+'\\n</div>' + '<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n\r\n                    outstr = U.replaceAll( outstr, '<span style=\"color:#000\"> ],\\n',\r\n                        ']</span>\\n</div>' + '<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n\r\n                    outstr = U.replaceAll( outstr, ': {},\\n',\r\n                        ': {}</span>\\n</div>' + '<div class=\"output-row\" tabindex=\"984\">');\r\n                    // let regexpFixArray = /,?\\s\\[length\\]:\\s<span style=\"color:#A50\">\\d<span style=\"color:#000\">\\s/gm;\r\n                    windoww.outp = outstr;\r\n                    // let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+]/gm;\r\n                    let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+(<span style=\"color:#000\">\\s){0,1}]/gm\r\n                    outstr = outstr.replaceAll(regexpFixArray, \"&nbsp;]</span>\");\r\n                    outstr = U.replaceAll( outstr, ': [&nbsp;]', ': []');\r\n\r\n                }\r\n                let postprocessold: boolean = false;\r\n                if (postprocessold){\r\n                    outstr = U.replaceAll( outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n',\r\n                        '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n                    /*outstr = U.replaceAll( outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n',\r\n                        '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');*/\r\n\r\n                    outstr = U.replaceAll( outstr, '],\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n                    outstr = U.replaceAll( outstr, '},\\n', '},</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n\r\n                }\r\n            }\r\n            ashtml = true; }\r\n        catch(e: any) {\r\n            console.error(e);\r\n            throw e;\r\n            outstr = \"[circular object]: \" + e.toString();\r\n            ashtml = false;\r\n        }\r\n        let contextkeysarr: (string)[];\r\n        let contextkeys: ReactNode = '';\r\n        if (this.state.expression.trim() === \"this\") contextkeys = \"Warning: \\\"this\\\" in the console is aliased to data instead of the whole context of a GraphElement component.\";\r\n\r\n        let objraw = this.state.output?.__raw || (typeof this.state.output === \"object\" ? this.state.output : \"[primitiveValue]\") || {};\r\n        if (this.state.expression.trim() === \"\") contextkeysarr = [\"data\", \"node\", \"view\", \"component\"];\r\n        else if (typeof objraw === \"string\") { contextkeysarr = Object.keys(String.prototype); }\r\n        else contextkeysarr = (Array.isArray(objraw) ?\r\n                [...(Object.keys(objraw) as any as number[]).filter(k => (k) <= 10).map(k=>k===10 ? '...' : ''+k), ...Object.keys(Array.prototype)]\r\n                : Object.getOwnPropertyNames(objraw)) || [];\r\n\r\n\r\n        let injectCommentJSX = () => {\r\n            try{ for (let key in jsxComments) {\r\n                if (hiddenkeys.includes(key)) continue;\r\n                let commentNode: HTMLElement | null = document.getElementById(\"console_output_comment_\"+key);\r\n                Log.eDev(!commentNode, \"failed to find comment placeholder\", {key, v:jsxComments[key], jsxComments});\r\n                if (commentNode) ReactDOM.render(jsxComments[key], commentNode);\r\n                // for shortcut or context keys, this can fail without warning as some shortcuts are missing\r\n                commentNode = document.getElementById(\"console_output_comment_key_\"+key);\r\n                if (commentNode) ReactDOM.render(jsxComments[key], commentNode);\r\n            } }\r\n            catch (e) { console.error(\"failed to inject console output comment:\", e)}\r\n        }\r\n        setTimeout(injectCommentJSX, 1)\r\n        this.setNativeConsoleVariables();\r\n        windoww.output = output;\r\n        const undo = ()=>{\r\n            let expressionIndex = Math.max(0, this.state.expressionIndex - 1);\r\n            if (expressionIndex === this.state.expressionIndex) return;\r\n            this.setState({ expressionIndex })\r\n        }\r\n        const redo = ()=>{\r\n            const expressionHistory = this.state.expressionHistory;\r\n            let expressionIndex = Math.min(expressionHistory.length-1, this.state.expressionIndex + 1);\r\n            if (expressionIndex === this.state.expressionIndex) return;\r\n            this.setState({ expressionIndex })\r\n        }\r\n        let canredo = this.state.expressionIndex < this.state.expressionHistory.length - 1;\r\n        let canundo = this.state.expressionIndex > 0;\r\n        let advanced = this.props.advanced;\r\n\r\n        contextkeys = <ul>{\r\n            contextkeysarr.sort().map(k=>this.getClickableEntry(jsxComments, comments||{} as any, expression, k))\r\n        }</ul>;\r\n\r\n        if (shortcuts) {\r\n            shortcutsjsx = <ul>{\r\n                Object.keys(shortcuts).sort().map(k=>this.getClickableEntry(jsxComments, comments||{} as any, expression, k, shortcuts))\r\n            }</ul>\r\n        }\r\n\r\n        return(<div className={'w-100 h-100 p-2 console'}>\r\n            <h1>\r\n                On {((data as GObject)?.name || \"model-less node (\" + this.props.node?.className + \")\") + \" - \" + this.props.node?.className}\r\n            </h1>\r\n            <div className='console-terminal p-0 mb-2 w-100'>\r\n                <div className='commands'>\r\n                    <i onClick={(e) => {\r\n                        this.setState({expression: '', expressionHistory:[''], expressionIndex:0})\r\n                    }} title={'Empty console'} className=\"bi bi-slash-circle\"/>\r\n                    <i onClick={(e) => {\r\n                        if (!this.state.expression.trim()) {\r\n                            return Tooltip.show('Nothing to copy', undefined, undefined, 2);\r\n                        }\r\n                        let s = this.outputhtml?.innerText || '';\r\n                        s = s.substring('Result'.length).trim();\r\n                        U.clipboardCopy(s, () => Tooltip.show('Content copied to clipboard', undefined, undefined, 2));\r\n                    }} title={'Copy in the clipboard'} className=\"bi bi-clipboard-plus\"/>\r\n                    {/* @ts-ignore */}\r\n                    <i onClick={redo} title={'redo'}\r\n                       className={\"redo bi bi-arrow-right-square\" + (canredo ? '' : \" disabled\")}/>\r\n                    {/* @ts-ignore */}\r\n                    <i onClick={undo} title={'undo'}\r\n                       className={\"undo bi bi-arrow-left-square\" + (canundo ? '' : \" disabled\")}/>\r\n                </div>\r\n                <textarea id={'console'} spellCheck={false} className={'p-0 input w-100'} onChange={this.change}\r\n                          value={this.state.expression}></textarea>\r\n            </div>\r\n            {advanced && this.state.expressionHistory.length>1 && <div>Advanced query history (index = {this.state.expressionIndex})\r\n                {this.state.expressionHistory.slice(-5).map((s, i) => i === 0 ? null : <>\r\n                    <div style={{\r\n                        border: '1px solid ' + (i === this.state.expressionIndex ? 'red' : 'gray'),\r\n                        marginTop: '5px',\r\n                        height: '30px'\r\n                    }}>{(i) + ') ' + s}</div>\r\n                </>)}</div>}\r\n            {/*<label>Query {(this.state.expression)}</label>*/}\r\n            <hr className={'mt-1 mb-1'}/>\r\n            {this.state.expression && ashtml && <div className={\"console-output-container console-msg\"}\r\n                                                     ref={(e) => this.outputhtml = e}\r\n                                                     dangerouslySetInnerHTML={ashtml ? {__html: outstr as string} : undefined}/>}\r\n\r\n            {this.state.expression && !ashtml && <div className={\"console-output-container console-msg\"}\r\n                                                      ref={(e) => this.outputhtml = e}\r\n                                                      style={{whiteSpace: \"pre\"}}>{outstr}</div>}\r\n\r\n\r\n            {contextkeysarr.length && <section className={'group context-keys-list'} style={{whiteSpace: \"pre\"}}>\r\n                    <label className={\"context-keys\"}>Context keys</label>\r\n                    {contextkeys}\r\n                </section>\r\n            }\r\n            {shortcutsjsx && <section className='group shortcuts-container'>\r\n                <label className={\"context-keys pt-0\"}>Shortcuts</label>\r\n                {shortcutsjsx}\r\n            </section>}\r\n        </div>)\r\n    }\r\n\r\n    private setNativeConsoleVariables(): void { // just fordebugging\r\n        let context = this._context;\r\n        windoww.context = context;\r\n        windoww.data = context.data;\r\n        windoww.node = context.node;\r\n        windoww.edge = context.edge;\r\n        windoww.output = this.state.output;\r\n        if (context.data?.model) windoww.model = context.data?.model;\r\n    }\r\n}\r\n\r\ninterface OwnProps {}\r\ninterface StateProps {\r\n    data: LModelElement|null;\r\n    node: LGraphElement|null;\r\n    view: LViewElement|null;\r\n    advanced: boolean;\r\n}\r\ninterface DispatchProps {}\r\n\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    const nodeid = state._lastSelected?.node;\r\n    const node: LGraphElement|null = (nodeid) ? LGraphElement.fromPointer(nodeid) : null;\r\n    ret.node = node;\r\n    ret.data = (node?.model) ? node.model : null;\r\n    ret.view = (node?.view) ? node.view : null;\r\n    ret.advanced = state.advanced;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ConsoleConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ConsoleComponent);\r\n\r\nexport const Console = (props: OwnProps, children: (string | Component)[] = []): ReactElement => {\r\n    return <ConsoleConnected {...{...props, children}} />;\r\n}\r\nexport default Console;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}
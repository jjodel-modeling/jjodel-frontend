{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect}from\"react\";import{connect}from\"react-redux\";import{useStateIfMounted}from\"use-state-if-mounted\";import{LViewElement,Defaults}from\"../../../joiner\";import Editor,{useMonaco}from\"@monaco-editor/react\";// import monacoTypes2 from '!raw-loader!../../../static/monacotypes';\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function JsxEditorComponent(props){var monaco=useMonaco();var view=props.view;var dview=view.__raw;var readOnly=props.readonly!==undefined?props.readonly:!props.debugmode&&Defaults.check(dview.id);var _useStateIfMounted=useStateIfMounted(dview.jsxString||''),_useStateIfMounted2=_slicedToArray(_useStateIfMounted,2),jsx=_useStateIfMounted2[0],setJsx=_useStateIfMounted2[1];var change=function change(value){// save in local state for frequent changes.\nif(value!==undefined)setJsx(value);};var blur=function blur(evt){// confirm in redux state for final state\nview.jsxString=jsx;};useEffect(function(){if(!monaco)return;monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.Latest,allowNonTsExtensions:true,moduleResolution:monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:monaco.languages.typescript.ModuleKind.CommonJS,noEmit:true,esModuleInterop:true,jsx:monaco.languages.typescript.JsxEmit.React,reactNamespace:\"React\",allowJs:true,typeRoots:[\"node_modules/@types\"]//, 'src/static/'], // doubt those can be accesed at runtime but trying\n});monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:false,noSyntaxValidation:false});monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);monaco.languages.typescript.typescriptDefaults.addExtraLib(\"declare var data: 'datatype';\");/*\r\n        // doubt those files can be accesed at runtime but trying\r\n        monaco.languages.typescript.javascriptDefaults.addExtraLib('declare var data: LModelElement; declare var node: LGraphElement;', 'src/static/monacotypes.d.ts');\r\n\r\n        monaco.languages.typescript.typescriptDefaults.addExtraLib(\r\n            '<<react-definition-file>>',\r\n            `file:///node_modules/@react/types/index.d.ts`\r\n        );*/},[monaco]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{className:\"ms-1 mb-1 d-block jj-editor-title\",children:\"JSX Editor\"}),jsx.indexOf('<>')>=0&&/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'red'},children:\"Warning:\"}),\": JSX.Fragment \",\"<>\",\" is valid JSX but is not supported by our compiler.\",/*#__PURE__*/_jsx(\"br\",{}),\"Please replace it with an array [] instead.\"]}),jsx.indexOf('?.')>=0&&/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'red'},children:\"Warning:\"}),\" Optional chaining \",\".?\",\" is valid JS but is not supported by our compiler.\",/*#__PURE__*/_jsx(\"br\",{}),\"Please replace it with && instead. Eg: from (a?.b) to (a && a.b)\"]}),jsx.indexOf('??')>=0&&/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'red'},children:\"Warning:\"}),\": Nullish coalescing \",\"??\",\" is valid JS but is not supported by our compiler.\",/*#__PURE__*/_jsx(\"br\",{}),\"Please replace it with explicit null and undefined checks, or a ||.\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"monaco-editor-wrapper\",style:{minHeight:'20ùpx',height:'200px'/*there is a bug of height 100% on childrens not working if parent have only minHeight*/,resize:'vertical',overflow:'hidden'},tabIndex:-1,onBlur:blur,children:/*#__PURE__*/_jsx(Editor,{className:'mx-1',onChange:change,language:\"typescript\",options:{fontSize:12,scrollbar:{vertical:'hidden',horizontalScrollbarSize:5},minimap:{enabled:false},readOnly:readOnly},defaultLanguage:'typescript',value:dview.jsxString})})]});}function mapStateToProps(state,ownProps){var ret={};ret.debugmode=state.debug;ret.view=LViewElement.fromPointer(ownProps.viewid);return ret;}function mapDispatchToProps(dispatch){var ret={};return ret;}export var JsxEditorConnected=connect(mapStateToProps,mapDispatchToProps)(JsxEditorComponent);export var JsxEditor=function JsxEditor(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(JsxEditorConnected,_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})));};JsxEditorComponent.cname=\"JsxEditorComponent\";JsxEditorConnected.cname=\"JsxEditorConnected\";JsxEditor.cname=\"JsxEditor\";export default JsxEditor;","map":{"version":3,"names":["React","useEffect","connect","useStateIfMounted","LViewElement","Defaults","Editor","useMonaco","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","JsxEditorComponent","props","monaco","view","dview","__raw","readOnly","readonly","undefined","debugmode","check","id","_useStateIfMounted","jsxString","_useStateIfMounted2","_slicedToArray","setJsx","change","value","blur","evt","languages","typescript","typescriptDefaults","setCompilerOptions","target","ScriptTarget","Latest","allowNonTsExtensions","moduleResolution","ModuleResolutionKind","NodeJs","module","ModuleKind","CommonJS","noEmit","esModuleInterop","JsxEmit","reactNamespace","allowJs","typeRoots","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","javascriptDefaults","setEagerModelSync","addExtraLib","children","className","indexOf","style","color","minHeight","height","resize","overflow","tabIndex","onBlur","onChange","language","options","fontSize","scrollbar","vertical","horizontalScrollbarSize","minimap","enabled","defaultLanguage","mapStateToProps","state","ownProps","ret","debug","fromPointer","viewid","mapDispatchToProps","dispatch","JsxEditorConnected","JsxEditor","arguments","length","_objectSpread","cname"],"sources":["C:/d/Programming/web/jodel-mde/src/components/rightbar/jsxEditor/JsxEditor.tsx"],"sourcesContent":["import React, {Dispatch, ReactElement, useEffect} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport type {FakeStateProps} from \"../../../joiner/types\";\r\nimport {DState, DViewElement, LViewElement, Pointer, Defaults} from \"../../../joiner\";\r\nimport Editor, { useMonaco } from \"@monaco-editor/react\";\r\n\r\n// import monacoTypes2 from '!raw-loader!../../../static/monacotypes';\r\nimport monacoTypes from '../../../static/monacotypes';\r\n\r\nfunction JsxEditorComponent(props: AllProps) {\r\n    const monaco = useMonaco();\r\n    const view = props.view;\r\n    const dview = view.__raw;\r\n    const readOnly = props.readonly !== undefined ? props.readonly : !props.debugmode && Defaults.check(dview.id);\r\n    const [jsx, setJsx] = useStateIfMounted(dview.jsxString||'');\r\n\r\n    const change = (value: string|undefined) => { // save in local state for frequent changes.\r\n        if (value !== undefined) setJsx(value);\r\n    }\r\n\r\n\r\n    const blur = (evt: React.FocusEvent) => { // confirm in redux state for final state\r\n        view.jsxString = jsx;\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!monaco) return;\r\n        monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\r\n            target: monaco.languages.typescript.ScriptTarget.Latest,\r\n            allowNonTsExtensions: true,\r\n            moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,\r\n            module: monaco.languages.typescript.ModuleKind.CommonJS,\r\n            noEmit: true,\r\n            esModuleInterop: true,\r\n            jsx: monaco.languages.typescript.JsxEmit.React,\r\n            reactNamespace: \"React\",\r\n            allowJs: true,\r\n            typeRoots: [\"node_modules/@types\"]//, 'src/static/'], // doubt those can be accesed at runtime but trying\r\n        });\r\n\r\n        monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: false, noSyntaxValidation: false });\r\n        monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);\r\n\r\n        monaco.languages.typescript.typescriptDefaults.addExtraLib(\"declare var data: 'datatype';\");\r\n        /*\r\n        // doubt those files can be accesed at runtime but trying\r\n        monaco.languages.typescript.javascriptDefaults.addExtraLib('declare var data: LModelElement; declare var node: LGraphElement;', 'src/static/monacotypes.d.ts');\r\n\r\n        monaco.languages.typescript.typescriptDefaults.addExtraLib(\r\n            '<<react-definition-file>>',\r\n            `file:///node_modules/@react/types/index.d.ts`\r\n        );*/\r\n\r\n\r\n\r\n    }, [monaco]);\r\n\r\n    return <>\r\n        <label className={\"ms-1 mb-1 d-block jj-editor-title\"}>JSX Editor</label>\r\n        {(jsx).indexOf('<>') >= 0 &&\r\n            <b><span style={{color:'red'}}>Warning:</span>: JSX.Fragment {\"<>\"} is valid JSX but is not supported by our compiler.<br/>\r\n                Please replace it with an array [] instead.</b>}\r\n        {(jsx).indexOf('?.') >= 0 &&\r\n            <b><span style={{color:'red'}}>Warning:</span> Optional chaining {\".?\"} is valid JS but is not supported by our compiler.<br/>\r\n                Please replace it with && instead. Eg: from (a?.b) to (a && a.b)</b>}\r\n        {(jsx).indexOf('??') >= 0 &&\r\n            <b><span style={{color:'red'}}>Warning:</span>: Nullish coalescing {\"??\"} is valid JS but is not supported by our compiler.<br/>\r\n                Please replace it with explicit null and undefined checks, or a ||.</b>}\r\n        <div className={\"monaco-editor-wrapper\"} style={{\r\n            minHeight: '20ùpx', height:'200px'/*there is a bug of height 100% on childrens not working if parent have only minHeight*/,\r\n            resize: 'vertical', overflow:'hidden'}} tabIndex={-1} onBlur={blur}>\r\n            <Editor className={'mx-1'} onChange={change} language={\"typescript\"}\r\n                    options={{fontSize: 12, scrollbar: {vertical: 'hidden', horizontalScrollbarSize: 5}, minimap: {enabled: false}, readOnly: readOnly}}\r\n                    defaultLanguage={'typescript'} value={dview.jsxString} />\r\n        </div>\r\n    </>;\r\n}\r\ninterface OwnProps {\r\n    viewid: Pointer<DViewElement, 1, 1, LViewElement>;\r\n    readonly?: boolean;\r\n}\r\n\r\ninterface StateProps {\r\n    view: LViewElement;\r\n    debugmode: boolean;\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    ret.debugmode = state.debug;\r\n    ret.view = LViewElement.fromPointer(ownProps.viewid);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const JsxEditorConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(JsxEditorComponent);\r\n\r\nexport const JsxEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <JsxEditorConnected {...{...props, children}} />;\r\n}\r\n\r\nJsxEditorComponent.cname = \"JsxEditorComponent\";\r\nJsxEditorConnected.cname = \"JsxEditorConnected\";\r\nJsxEditor.cname = \"JsxEditor\";\r\nexport default JsxEditor;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
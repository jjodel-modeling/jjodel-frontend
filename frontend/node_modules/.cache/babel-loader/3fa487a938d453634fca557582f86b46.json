{"ast":null,"code":"import _slicedToArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _createForOfIteratorHelper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import React from'react';import{Log}from\"../../joiner\";import{useStateIfMounted}from\"use-state-if-mounted\";import\"./FunctionComponent.scss\";/*\r\n Rationale behind this:\r\n To do this properly, one would need a complete js parser to make sure comments, ifs, loops, newlines,\r\n   expressions inside array indexing for objects... are all correctly parsed.\r\n\r\n\r\n Instead, to make it faster, i'm forcing the valid \"function string\" value to hold a much more definite structure\r\n   for which i can do an extremely simpler inline parser.\r\n The getter and setter properties and the interface, are making sure the user cannot write a \"function string\"\r\n   not respecting my format, and that it is as much turing-complete as javascript is.\r\n\r\n legenda:\r\n  - ALL_CAPS identifiers, are not literals and the user can change their names.\r\n  - Newlines are included in the format, spaces are not.\r\n  - ... are explaining the format and are not part of it.\r\n  - // **   ** // Styled comments ARE part of the format.\r\n  - Excess spaces in the format are not preserved (might be added/removed by getter/setter), but not mandatory and not relevant.\r\n\r\n my structure is:\r\n (OBJECT_NAME)=> {\\n\r\n   STATEMENT_A1\r\n   STATEMENT_A2\r\n   ...\r\n   STATEMENT_AN\r\n   \\n// ** declarations here ** //\\n\r\n   OBJECT_NAME.IDENTIFIER_1 = STATEMENT_1;\\n\r\n   OBJECT_NAME.IDENTIFIER_2 = STATEMENT_2;\\n\r\n   ...\r\n   OBJECT_NAME.IDENTIFIER_N = STATEMENT_N;\\n\r\n }\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var minimalTextareaValue='(ret)=>{\\n';function parseFunction(props){Log.exDev(!props.data,\"FunctionComponent: missing data props\",{props:props});var getter=props.getter||function(a){return a[props.field];};// ((lobj: GObject<LPointerTargetable>, key: string) => U.wrapUserFunction(lobj[key]));\nvar val=getter(props.data);if(!val||val.length<=2)val=\"(ret)=>{\\n    // ** declarations here ** //\\n\\n}\";// fallback for empty string and {}\nelse val=val.trim();var txtparts=val.split(\"// ** declarations here ** //\");if(txtparts.length!==2){Log.eDevv(\"cannot find declaration section\",{val:val,props:props});txtparts=[val.substring(0,val.length-1),val.substring(val.length-1)];}var declarations=(txtparts[1]||'').split(\"\\n\");var stateArrayValues=[];var textAreaState={v:txtparts[0]};var i=-1;var _iterator=_createForOfIteratorHelper(declarations),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var dec=_step.value;var splitindex=dec.indexOf(\"=\");if(splitindex===-1)continue;// for ending \\n} line\ni++;// don't loop by i, the index ending in state must increase only for non-empty rows filtering them out.\nvar expression=dec.substring(splitindex+1);var identifier=dec.substring(0,splitindex);var idsplitindex=identifier.indexOf(\".\");var identifierPrefix=identifier.substring(0,idsplitindex);var identifierName=identifier.substring(idsplitindex+1);stateArrayValues.push({index:i,key:i,id:{prefix:identifierPrefix,value:identifierName.trim(),line:i,startindex:idsplitindex,endindex:splitindex},exp:{value:expression.trim(),line:i,startindex:splitindex,endindex:-1}});}}catch(err){_iterator.e(err);}finally{_iterator.f();}return{advancedMode:!!props.advancedMode,collapsed:props.collapsed===!!props.collapsed,ta:textAreaState,arr:stateArrayValues};}// event listing start\n// it's not on purpose, but this function is a candidate for obscure code context XD\nfunction addClick(v,set){var _v$arr$index,_v$arr,_v$arr$key,_v$arr2,_v$arr$;var lasti=((_v$arr$index=(_v$arr=v.arr[v.arr.length-1])===null||_v$arr===void 0?void 0:_v$arr.index)!==null&&_v$arr$index!==void 0?_v$arr$index:-1)+1;var lastk=((_v$arr$key=(_v$arr2=v.arr[v.arr.length-1])===null||_v$arr2===void 0?void 0:_v$arr2.key)!==null&&_v$arr$key!==void 0?_v$arr$key:-1)+1;set(_objectSpread(_objectSpread({},v),{},{arr:[].concat(_toConsumableArray(v.arr),[{index:lasti,key:lastk,id:{prefix:((_v$arr$=v.arr[0])===null||_v$arr$===void 0?void 0:_v$arr$.id.prefix)||\"ret\",value:\"\"},exp:{value:\"\"}}])}));}// function fixIndex(i: number, rows: RowData[]): number{ for (let row of rows) if (row.index === ) }\nfunction deleteClick(v0,set,i,props,row){// do i really need to shallow copy nested objects too? it should not be necessary\nvar v=_objectSpread({},v0);//, arr:[...v0.arr]};\n/// problem: deleting an element in the middle invalidetes the row.index values\n/// solution 1: update the row.index values, move the rect key to a different field that is initial = index, but never changes.\n/// implemented\nv.arr.splice(i,1);for(;i<v.arr.length;i++){v.arr[i].index=i;}/// solution 2: keep original indexes, use a fixIndex function to map the index in html (without holes) to index in row structure (with holes).\n///  discareded\nset(v);_onBlur(v,set,props,undefined,true);}function expressionChange(e,i,v,set){v=_objectSpread(_objectSpread({},v),{},{arr:_toConsumableArray(v.arr)});v.arr[i]=_objectSpread(_objectSpread({},v.arr[i]),{},{isDirty:true,exp:_objectSpread(_objectSpread({},v.arr[i].exp),{},{value:e.currentTarget.value})});set(v);}function identifierChange(e,i,v,set){var nv=e.currentTarget.value;v=_objectSpread(_objectSpread({},v),{},{arr:_toConsumableArray(v.arr)});v.arr[i]=_objectSpread(_objectSpread({},v.arr[i]),{},{isDirty:true,// empty string is fine, as long value is empty too the entire row is ignored. but identifiers cannot start with a number are not allowed.\nid:_objectSpread(_objectSpread({},v.arr[i].id),{},{value:isNaN(+nv[0])?nv:\"A\"+nv})});set(v);}function textAreaChange(e,v,set){set(_objectSpread(_objectSpread({},v),{},{ta:{v:e.currentTarget.value,isDirty:true}}));}function _onBlur(v,set,props,i,isDelete){if(isDelete){// force update without checking dirty (the row is not present anymore)\n}// problem: this might be called before the onChange setState() actually edits the state, so it finds isDirty false or even a non-yet existing index\n// for now i will just hope the user is not typing and blurring extra fast, i don't think a simple solution exists\nelse if(i!==undefined){var _v$arr$i;if(!((_v$arr$i=v.arr[i])===null||_v$arr$i===void 0?void 0:_v$arr$i.isDirty))return;v=_objectSpread(_objectSpread({},v),{},{arr:_toConsumableArray(v.arr)});v.arr[i]=_objectSpread(_objectSpread({},v.arr[i]),{},{isDirty:false});set(v);}else{if(!v.ta.isDirty)return;set(_objectSpread(_objectSpread({},v),{},{ta:{v:v.ta.v,isDirty:false}}));}updateFunctionValue(props,v.ta.v,v.arr);}function updateFunctionValue(props,textAreaContent,stateArrayValues){var declarations=stateArrayValues.map(function(o){return o.id.value&&o.exp.value?o.id.prefix+\".\"+o.id.value+\" = \"+o.exp.value:'';});var setter=props.setter||function(v){return props.data[props.field]=v;};setter(textAreaContent+\"\\n// ** declarations here ** //\\n\"+declarations.filter(function(d){return!!d;}).join(\"\\n\")+\"\\n}\");}// event listing end\nfunction FunctionComponent(props){var _ref;// if (false) return asTextArea(props) // i gave up\nvar _useStateIfMounted=useStateIfMounted(parseFunction(props)),_useStateIfMounted2=_slicedToArray(_useStateIfMounted,2),state=_useStateIfMounted2[0],setState=_useStateIfMounted2[1];var _useStateIfMounted3=useStateIfMounted(false),_useStateIfMounted4=_slicedToArray(_useStateIfMounted3,2),showTooltip=_useStateIfMounted4[0],setShowTooltip=_useStateIfMounted4[1];// if (!props.data) return <></>;\nvar advancedMode=state.advancedMode,readOnly=props.readonly;// (props.readonly !== undefined) ? props.readonly : !props.debugMode && props.data.id.indexOf(\"Pointer_View\") !== -1;\n// NB: could be heavily optimized by cutting the original string with indexes and substring,\n// but it is a function called too rarely and not impactful on overall performances\nvar tooltip=props.tooltip===true?(_ref=props.data['__info_of__'+props.field])===null||_ref===void 0?void 0:_ref.txt:props.tooltip;// JSX building start\nvar inputs=[];// console.log(\"funccomp\", {stateArrayValues, textAreaState, props});\nvar _iterator2=_createForOfIteratorHelper(state.arr),_step2;try{var _loop=function _loop(){var row=_step2.value;inputs.push(/*#__PURE__*/_jsxs(\"label\",{className:\"d-flex\"+(advancedMode?\"\":\" my-1\"),\"data-key\":row.index,children:[/*#__PURE__*/_jsxs(\"span\",{className:\"my-auto detailedMode\",children:[row.id.prefix,\".\"]}),/*#__PURE__*/_jsx(\"input\",{className:\"my-auto input\",placeholder:\"identifier\",value:row.id.value,disabled:readOnly,tabIndex:row.index*2,onInput:function onInput(e){return identifierChange(e,row.index,state,setState);},onBlur:function onBlur(e){return!readOnly&&_onBlur(state,setState,props,row.index);}}),/*#__PURE__*/_jsx(\"span\",{className:\"my-auto mx-1 simpleMode\",style:{fontWeight:\"bold\"},children:\"\\u21E0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"my-auto mx-1 detailedMode\",children:\"=\"}),/*#__PURE__*/_jsx(\"input\",{className:\"my-auto input\",placeholder:\"expression\",value:row.exp.value,disabled:readOnly,tabIndex:row.index*2+1,onInput:function onInput(e){return expressionChange(e,row.index,state,setState);},onBlur:function onBlur(e){return!readOnly&&_onBlur(state,setState,props,row.index);}}),/*#__PURE__*/_jsx(\"span\",{className:\"my-auto detailedMode\",children:\";\"}),/*#__PURE__*/_jsx(\"button\",{className:\"bg btn-delete my-auto ms-2\",tabIndex:state.arr.length*2+1+row.index,disabled:readOnly,onClick:function onClick(){return!readOnly&&deleteClick(state,setState,row.index,props,row);},children:/*#__PURE__*/_jsx(\"i\",{className:\"p-1 bi bi-dash\"})})]},row.index));};for(_iterator2.s();!(_step2=_iterator2.n()).done;){_loop();}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}var transitionTime=300;return/*#__PURE__*/_jsxs(\"div\",{className:\"function-editor-root\",\"data-mode\":advancedMode?\"detailedMode\":\"simpleMode\",style:{fontSize:\"0.9rem\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex w-100 function-editor-header\",style:{transition:\"all 300ms\",cursor:tooltip?'help':'auto'},onMouseEnter:function onMouseEnter(e){return tooltip&&setShowTooltip(true);},onMouseLeave:function onMouseLeave(e){return tooltip&&setShowTooltip(false);},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex function-editor-label\",children:[props.jsxLabel,/*#__PURE__*/_jsx(\"button\",{className:\"btn button-add\",tabIndex:state.arr.length*2,disabled:readOnly,onClick:function onClick(){return!readOnly&&addClick(state,setState);},children:\"+\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"m-auto me-1\",style:{cursor:'auto'},children:[tooltip&&/*#__PURE__*/_jsx(\"i\",{className:\"p1 m-auto me-1 bi bi-info-square\",style:{cursor:'help'}}),/*#__PURE__*/_jsxs(\"span\",{className:\"m-auto\",style:{cursor:'auto',height:\"100%\",display:\"inline-block\"},onMouseEnter:function onMouseEnter(e){return tooltip&&setShowTooltip(false);},onMouseLeave:function onMouseLeave(e){return tooltip&&setShowTooltip(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"p1 m-auto mx-1 bi \"+(advancedMode?\"btn-outline-secondary bi-eye-slash\":\"btn-outline-secondary bi-eye\"),onClick:function onClick(){return setState(_objectSpread(_objectSpread({},state),{},{advancedMode:!state.advancedMode}));},style:{cursor:'pointer'}}),/*#__PURE__*/_jsx(\"i\",{className:\"p1 bi m-auto mx-1 bi bi-chevron-down btn-outline-secondary\",onClick:function onClick(){return setState(_objectSpread(_objectSpread({},state),{},{collapsed:!state.collapsed}));},style:{cursor:'pointer',transition:transitionTime/2+\"ms all\",transform:\"scaleY(\"+(state.collapsed?1:-1)+\")  translateY(\"+(state.collapsed?-0:0.1)+\"em)\"}})]})]})]}),tooltip&&showTooltip&&/*#__PURE__*/_jsxs(\"div\",{className:'my-tooltip',children:[/*#__PURE__*/_jsx(\"b\",{className:'text-center text-capitalize',children:props.field}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"label\",{children:tooltip})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"collapsable-section\",\"data-comment\":\"collapsable-section\",style:{transition:transitionTime+\"ms all\",// transformOrigin: \"top\", transform: \"rotateX(\"+(state.collapsed ? 0 : 90 )+\"deg)\",\ntransform:\"scaleY(\"+(state.collapsed?0:1)+\")\",overflow:\"hidden\"},children:[/*#__PURE__*/_jsx(\"textarea\",{className:\"detailedMode input w-100\",disabled:readOnly,rows:Math.min(10,state.ta.v.split(\"\\n\").length),onInput:function onInput(e){return textAreaChange(e,state,setState);},onBlur:function onBlur(e){return!readOnly&&_onBlur(state,setState,props);},\"data-txtcontent\":state.ta.v,value:state.ta.v}),inputs,false&&/*#__PURE__*/_jsx(\"div\",{style:{whiteSpace:\"pre\"},children:props.data[props.field]})]})]});}/*\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n  return ownProps;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const FunctionConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(FunctionComponent);\r\n*/ // export const Function = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => (<FunctionConnected {...{...props, children}} />);\nexport var Function=function Function(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(FunctionComponent,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{tooltip:true}));};Function.cname=\"FunctionComponent\";// FunctionConnected.cname = \"FunctionComponent_Connected\";\nFunctionComponent.cname=\"FunctionComponent_Disconnected\";","map":{"version":3,"names":["React","Log","useStateIfMounted","jsx","_jsx","jsxs","_jsxs","minimalTextareaValue","parseFunction","props","exDev","data","getter","a","field","val","length","trim","txtparts","split","eDevv","substring","declarations","stateArrayValues","textAreaState","v","i","_iterator","_createForOfIteratorHelper","_step","s","n","done","dec","value","splitindex","indexOf","expression","identifier","idsplitindex","identifierPrefix","identifierName","push","index","key","id","prefix","line","startindex","endindex","exp","err","e","f","advancedMode","collapsed","ta","arr","addClick","set","_v$arr$index","_v$arr","_v$arr$key","_v$arr2","_v$arr$","lasti","lastk","_objectSpread","concat","_toConsumableArray","deleteClick","v0","row","splice","onBlur","undefined","expressionChange","isDirty","currentTarget","identifierChange","nv","isNaN","textAreaChange","isDelete","_v$arr$i","updateFunctionValue","textAreaContent","map","o","setter","filter","d","join","FunctionComponent","_ref","_useStateIfMounted","_useStateIfMounted2","_slicedToArray","state","setState","_useStateIfMounted3","_useStateIfMounted4","showTooltip","setShowTooltip","readOnly","readonly","tooltip","txt","inputs","_iterator2","_step2","_loop","className","children","placeholder","disabled","tabIndex","onInput","style","fontWeight","onClick","transitionTime","fontSize","transition","cursor","onMouseEnter","onMouseLeave","jsxLabel","height","display","transform","overflow","rows","Math","min","whiteSpace","Function","arguments","cname"],"sources":["C:/d/Programming/web/jodel-mde/src/components/forEndUser/FunctionComponent.tsx"],"sourcesContent":["import React, {Dispatch, ReactElement, ReactNode, useEffect, useState} from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport type {Dictionary, DocString, GObject, DState, LViewElement, Pointer, Info} from \"../../joiner\";\r\nimport {Log, LPointerTargetable, U} from \"../../joiner\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {stringify} from \"querystring\";\r\nimport \"./FunctionComponent.scss\";\r\n\r\n/*\r\n Rationale behind this:\r\n To do this properly, one would need a complete js parser to make sure comments, ifs, loops, newlines,\r\n   expressions inside array indexing for objects... are all correctly parsed.\r\n\r\n\r\n Instead, to make it faster, i'm forcing the valid \"function string\" value to hold a much more definite structure\r\n   for which i can do an extremely simpler inline parser.\r\n The getter and setter properties and the interface, are making sure the user cannot write a \"function string\"\r\n   not respecting my format, and that it is as much turing-complete as javascript is.\r\n\r\n legenda:\r\n  - ALL_CAPS identifiers, are not literals and the user can change their names.\r\n  - Newlines are included in the format, spaces are not.\r\n  - ... are explaining the format and are not part of it.\r\n  - // **   ** // Styled comments ARE part of the format.\r\n  - Excess spaces in the format are not preserved (might be added/removed by getter/setter), but not mandatory and not relevant.\r\n\r\n my structure is:\r\n (OBJECT_NAME)=> {\\n\r\n   STATEMENT_A1\r\n   STATEMENT_A2\r\n   ...\r\n   STATEMENT_AN\r\n   \\n// ** declarations here ** //\\n\r\n   OBJECT_NAME.IDENTIFIER_1 = STATEMENT_1;\\n\r\n   OBJECT_NAME.IDENTIFIER_2 = STATEMENT_2;\\n\r\n   ...\r\n   OBJECT_NAME.IDENTIFIER_N = STATEMENT_N;\\n\r\n }\r\n */\r\n\r\ntype StrPos = {value: string, line?: number, startindex?: number, endindex?: number};\r\ntype RowData = {index: number; key: number, id: StrPos & { prefix: string }; exp: StrPos, isDirty?: boolean};\r\ntype TextAreaState = {v:string, isDirty?: boolean};\r\ntype FunctionComponentState = {advancedMode: boolean, collapsed: boolean, ta: TextAreaState, arr: RowData[]};\r\ntype SetState = (value: FunctionComponentState)=>void;\r\nconst minimalTextareaValue = '(ret)=>{\\n';\r\n\r\nfunction parseFunction(props: AllProps): FunctionComponentState {\r\n    Log.exDev(!props.data, \"FunctionComponent: missing data props\", {props});\r\n    let getter = props.getter || ((a: GObject) => a[props.field]); // ((lobj: GObject<LPointerTargetable>, key: string) => U.wrapUserFunction(lobj[key]));\r\n    let val: string = getter(props.data);\r\n    if (!val || val.length <= 2) val = \"(ret)=>{\\n    // ** declarations here ** //\\n\\n}\"; // fallback for empty string and {}\r\n    else val = val.trim();\r\n    let txtparts = val.split(\"// ** declarations here ** //\");\r\n    if (txtparts.length !== 2) {\r\n        Log.eDevv(\"cannot find declaration section\", {val, props});\r\n        txtparts = [val.substring(0, val.length-1), val.substring(val.length-1)];\r\n    }\r\n    let declarations: string[] = (txtparts[1] || '').split(\"\\n\");\r\n    let stateArrayValues: RowData[] = [];\r\n    let textAreaState: TextAreaState = {v: txtparts[0]};\r\n    let i: number = -1;\r\n    for (let dec of declarations) {\r\n        let splitindex = dec.indexOf(\"=\");\r\n        if (splitindex === -1) continue; // for ending \\n} line\r\n        i++; // don't loop by i, the index ending in state must increase only for non-empty rows filtering them out.\r\n        let expression = dec.substring(splitindex+1);\r\n        let identifier = dec.substring(0, splitindex);\r\n        let idsplitindex = identifier.indexOf(\".\");\r\n        let identifierPrefix = identifier.substring(0, idsplitindex);\r\n        let identifierName = identifier.substring(idsplitindex+1);\r\n        stateArrayValues.push({\r\n            index: i,\r\n            key: i,\r\n            id: {prefix: identifierPrefix, value: identifierName.trim(), line: i, startindex: idsplitindex, endindex: splitindex},\r\n            exp:{                          value: expression.trim(),     line: i, startindex: splitindex,   endindex: -1}\r\n        });\r\n    }\r\n    return {advancedMode: !!props.advancedMode, collapsed: props.collapsed === !!props.collapsed, ta: textAreaState, arr:stateArrayValues};\r\n}\r\n\r\n// event listing start\r\n// it's not on purpose, but this function is a candidate for obscure code context XD\r\nfunction addClick(v: FunctionComponentState, set: SetState): void {\r\n    let lasti: number = (v.arr[v.arr.length-1]?.index ?? -1) +1;\r\n    let lastk: number = (v.arr[v.arr.length-1]?.key ?? -1) +1;\r\n    set({...v, arr: [...v.arr, {index: lasti, key: lastk,\r\n            id: {prefix: v.arr[0]?.id.prefix || \"ret\", value: \"\"},\r\n            exp: {value: \"\"} }]\r\n    });\r\n}\r\n\r\n// function fixIndex(i: number, rows: RowData[]): number{ for (let row of rows) if (row.index === ) }\r\nfunction deleteClick(v0: FunctionComponentState, set: SetState, i: number, props: AllProps, row:RowData): void {\r\n    // do i really need to shallow copy nested objects too? it should not be necessary\r\n    let v = {...v0} //, arr:[...v0.arr]};\r\n    /// problem: deleting an element in the middle invalidetes the row.index values\r\n    /// solution 1: update the row.index values, move the rect key to a different field that is initial = index, but never changes.\r\n    /// implemented\r\n    v.arr.splice(i, 1);\r\n    for (; i < v.arr.length; i++) v.arr[i].index = i;\r\n    /// solution 2: keep original indexes, use a fixIndex function to map the index in html (without holes) to index in row structure (with holes).\r\n    ///  discareded\r\n\r\n    set(v);\r\n    onBlur(v, set, props, undefined, true);\r\n}\r\n\r\nfunction expressionChange(e: React.FormEvent<HTMLInputElement>, i: number, v: FunctionComponentState, set: SetState): void {\r\n    v = {...v, arr:[...v.arr]};\r\n    v.arr[i] = {\r\n        ...v.arr[i],\r\n        isDirty: true,\r\n        exp: {...v.arr[i].exp, value: e.currentTarget.value}\r\n    };\r\n    set(v);\r\n}\r\n\r\nfunction identifierChange(e: React.FormEvent<HTMLInputElement>, i: number, v: FunctionComponentState, set: SetState): void {\r\n    let nv = e.currentTarget.value;\r\n    v = {...v, arr:[...v.arr]};\r\n    v.arr[i] = {\r\n        ...v.arr[i],\r\n        isDirty: true,\r\n        // empty string is fine, as long value is empty too the entire row is ignored. but identifiers cannot start with a number are not allowed.\r\n        id: {...v.arr[i].id, value: isNaN(+nv[0]) ? nv : \"A\" + nv}\r\n    };\r\n    set(v);\r\n}\r\n\r\nfunction textAreaChange(e: React.FormEvent<HTMLTextAreaElement>, v: FunctionComponentState, set: SetState): void {\r\n    set({...v, ta: {v:e.currentTarget.value, isDirty: true} });\r\n}\r\n\r\nfunction onBlur(v: FunctionComponentState, set: SetState, props: AllProps, i?: number, isDelete?: boolean) {\r\n    if (isDelete) {\r\n        // force update without checking dirty (the row is not present anymore)\r\n    }\r\n    // problem: this might be called before the onChange setState() actually edits the state, so it finds isDirty false or even a non-yet existing index\r\n        // for now i will just hope the user is not typing and blurring extra fast, i don't think a simple solution exists\r\n    else if (i !== undefined) {\r\n        if (!v.arr[i]?.isDirty) return;\r\n        v = {...v, arr:[...v.arr]};\r\n        v.arr[i] = {\r\n            ...v.arr[i],\r\n            isDirty: false,\r\n        };\r\n        set(v);\r\n    }\r\n    else {\r\n        if (!v.ta.isDirty) return;\r\n        set({...v, ta: {v: v.ta.v, isDirty: false} });\r\n    }\r\n    updateFunctionValue(props, v.ta.v, v.arr);\r\n}\r\n\r\nfunction updateFunctionValue(props: AllProps, textAreaContent: string, stateArrayValues: RowData[]){\r\n    let declarations: string[] = stateArrayValues.map( o => o.id.value && o.exp.value ? o.id.prefix + \".\" + o.id.value + \" = \" + o.exp.value : '');\r\n    let setter = props.setter || ((v: string) => (props.data as GObject)[props.field] = v);\r\n    setter(textAreaContent + \"\\n// ** declarations here ** //\\n\" + declarations.filter(d=>!!d).join(\"\\n\") + \"\\n}\")\r\n}\r\n// event listing end\r\n\r\nfunction FunctionComponent(props: AllProps) {\r\n    // if (false) return asTextArea(props) // i gave up\r\n    const [state, setState] = useStateIfMounted(parseFunction(props));\r\n    const [showTooltip, setShowTooltip] = useStateIfMounted(false);\r\n    // if (!props.data) return <></>;\r\n    let advancedMode: boolean = state.advancedMode,\r\n        readOnly = props.readonly; // (props.readonly !== undefined) ? props.readonly : !props.debugMode && props.data.id.indexOf(\"Pointer_View\") !== -1;\r\n\r\n    // NB: could be heavily optimized by cutting the original string with indexes and substring,\r\n    // but it is a function called too rarely and not impactful on overall performances\r\n\r\n    let tooltip: string|undefined | ReactNode = (props.tooltip === true) ? (props.data as GObject)['__info_of__' + props.field]?.txt : props.tooltip;\r\n\r\n\r\n    // JSX building start\r\n    let inputs: JSX.Element[] = [];\r\n    // console.log(\"funccomp\", {stateArrayValues, textAreaState, props});\r\n\r\n\r\n    for (let row of state.arr) {\r\n        inputs.push(<label className={\"d-flex\" + (advancedMode ? \"\" : \" my-1\")} key={row.index} data-key={row.index}>\r\n            <span className={\"my-auto detailedMode\"}>{row.id.prefix}.</span>\r\n            <input className={\"my-auto input\"} placeholder={\"identifier\"} value={row.id.value}  disabled={readOnly}\r\n                   tabIndex={row.index*2}\r\n                   onInput={(e)=>identifierChange(e, row.index, state, setState)}\r\n                   onBlur={(e)=> !readOnly && onBlur(state, setState, props, row.index)}\r\n            />\r\n            <span className={\"my-auto mx-1 simpleMode\"} style={{fontWeight: \"bold\"}}>â‡ </span>\r\n            <span className={\"my-auto mx-1 detailedMode\"}>=</span>\r\n            <input className={\"my-auto input\"} placeholder={\"expression\"} value={row.exp.value} disabled={readOnly}\r\n                   tabIndex={row.index*2+1}\r\n                   onInput={(e)=>expressionChange(e, row.index, state, setState)}\r\n                   onBlur={(e)=> !readOnly && onBlur(state, setState, props, row.index)}\r\n            />\r\n            <span className={\"my-auto detailedMode\"}>;</span>\r\n            <button className={\"bg btn-delete my-auto ms-2\"} tabIndex={state.arr.length*2 +1 +row.index} disabled={readOnly} onClick={()=>!readOnly && deleteClick(state, setState, row.index, props, row)}>\r\n                <i className={\"p-1 bi bi-dash\"} /></button>\r\n        </label>);\r\n    }\r\n\r\n    let transitionTime = 300;\r\n    return <div className={\"function-editor-root\"} data-mode={advancedMode ? \"detailedMode\" : \"simpleMode\"} style={{fontSize: \"0.9rem\"}}>\r\n        <div className={\"d-flex w-100 function-editor-header\"} style={{transition: \"all 300ms\",  cursor: tooltip ? 'help' : 'auto'}}\r\n             onMouseEnter={e => tooltip && setShowTooltip(true)} onMouseLeave={e =>  tooltip && setShowTooltip(false)}>\r\n            <div className={\"d-flex function-editor-label\"}>\r\n                {props.jsxLabel}\r\n                <button className={\"btn button-add\"} tabIndex={state.arr.length*2}\r\n                        disabled={readOnly} onClick={()=> !readOnly && addClick(state, setState)}>+</button>\r\n            </div>\r\n            <span className={\"m-auto me-1\"} style={{cursor: 'auto'}}>\r\n                {tooltip && <i className={\"p1 m-auto me-1 bi bi-info-square\"} style={{cursor: 'help'}} />}\r\n\r\n                <span className={\"m-auto\"} style={{cursor: 'auto', height: \"100%\", display: \"inline-block\"}}\r\n                      onMouseEnter={e => tooltip && setShowTooltip(false)} onMouseLeave={e =>  tooltip && setShowTooltip(true)}\r\n                >\r\n                <i className={ \"p1 m-auto mx-1 bi \" + (advancedMode ? \"btn-outline-secondary bi-eye-slash\" : \"btn-outline-secondary bi-eye\")}\r\n                   onClick={()=>setState( {...state, advancedMode:!state.advancedMode})} style={{cursor: 'pointer'}} />\r\n                <i className={ \"p1 bi m-auto mx-1 bi bi-chevron-down btn-outline-secondary\"}\r\n                   onClick={()=>setState( {...state, collapsed:!state.collapsed})}\r\n                   style={{cursor: 'pointer', transition:transitionTime/2 + \"ms all\",\r\n                       transform: \"scaleY(\"+(state.collapsed ? 1 : -1 )+\")  translateY(\" + (state.collapsed ? -0 : 0.1) +\"em)\",\r\n                   }} />\r\n                {/* erase all button removed<button className={ \"p1 m-auto mx-1 bi btn btn-danger bi-trash3-fill\"} disabled={!(props.data.__raw as GObject)[props.field]}\r\n                        onClick={()=>{ setState( {...state,  ta: {...state.ta, v:minimalTextareaValue}, arr: []}); (props.data as GObject)[props.field] = undefined}}\r\n                        style={{cursor: 'pointer'}} />*/}\r\n                </span>\r\n            </span>\r\n        </div>\r\n        {(tooltip && showTooltip) && <div className={'my-tooltip'}>\r\n            <b className={'text-center text-capitalize'}>{props.field}</b>\r\n            <br />\r\n            <label>{tooltip}</label>\r\n        </div>}\r\n        {<div className={\"collapsable-section\"} data-comment={\"collapsable-section\"} style={{transition: transitionTime + \"ms all\",\r\n            // transformOrigin: \"top\", transform: \"rotateX(\"+(state.collapsed ? 0 : 90 )+\"deg)\",\r\n            transform: \"scaleY(\"+(state.collapsed ? 0 : 1 )+\")\",\r\n            overflow:\"hidden\"}}>\r\n            <textarea className={\"detailedMode input w-100\"} disabled={readOnly} rows={Math.min(10, state.ta.v.split(\"\\n\").length)}\r\n                  onInput={(e)=>textAreaChange(e, state, setState)}\r\n                  onBlur={(e)=> !readOnly && onBlur(state, setState, props)}\r\n                  data-txtcontent={state.ta.v}\r\n                  value={state.ta.v}\r\n        />\r\n        {inputs}\r\n        {false && <div style={{whiteSpace:\"pre\"}}>{(props.data as any)[props.field]}</div>}\r\n        </div>}\r\n    </div>;\r\n}\r\n\r\ninterface OwnProps {\r\n    advancedMode?: boolean; // toggle textbox pre-declarations, initial value to set state. after initialization only state.advancedMode is used\r\n    collapsed?: boolean; // start collapsed or visible, default value is false = visible\r\n    data: LPointerTargetable;\r\n    field: string;\r\n    getter?: (data: LPointerTargetable) => string;\r\n    setter?: (value: string|boolean) => void;\r\n    readonly?: boolean;\r\n    // not used for now\r\n    label?: string;\r\n    jsxLabel?: ReactNode;\r\n    className?: string;\r\n    style?: GObject;\r\n    tooltip?: string | boolean | ReactElement;\r\n    hidden?: boolean;\r\n    autosize?: boolean;\r\n    inputClassName?: string;\r\n    inputStyle?: GObject;\r\n    asLabel?: boolean;\r\n    key?: React.Key | null;\r\n}\r\n\r\ninterface StateProps {\r\n}\r\n\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n/*\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n  return ownProps;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const FunctionConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(FunctionComponent);\r\n*/\r\n// export const Function = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => (<FunctionConnected {...{...props, children}} />);\r\nexport const Function = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => (<FunctionComponent {...{...props, children}} tooltip={true} />);\r\n\r\nFunction.cname = \"FunctionComponent\";\r\n// FunctionConnected.cname = \"FunctionComponent_Connected\";\r\nFunctionComponent.cname = \"FunctionComponent_Disconnected\";\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}